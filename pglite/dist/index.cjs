"use strict";var Ii=Object.create;var Et=Object.defineProperty;var Pi=Object.getOwnPropertyDescriptor;var Ai=Object.getOwnPropertyNames;var Di=Object.getPrototypeOf,Oi=Object.prototype.hasOwnProperty;var on=r=>{throw TypeError(r)};var L=(r,e)=>()=>(r&&(e=r(r=0)),e);var Z=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),de=(r,e)=>{for(var t in e)Et(r,t,{get:e[t],enumerable:!0})},an=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ai(e))!Oi.call(r,i)&&i!==t&&Et(r,i,{get:()=>e[i],enumerable:!(n=Pi(e,i))||n.enumerable});return r};var N=(r,e,t)=>(t=r!=null?Ii(Di(r)):{},an(e||!r||!r.__esModule?Et(t,"default",{value:r,enumerable:!0}):t,r)),Ni=r=>an(Et({},"__esModule",{value:!0}),r);var Xt=(r,e,t)=>e.has(r)||on("Cannot "+t);var p=(r,e,t)=>(Xt(r,e,"read from private field"),t?t.call(r):e.get(r)),b=(r,e,t)=>e.has(r)?on("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),x=(r,e,t,n)=>(Xt(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),d=(r,e,t)=>(Xt(r,e,"access private method"),t);var Jt=(r,e,t,n)=>({set _(i){x(r,e,i,t)},get _(){return p(r,e,n)}});var Ri,w,m=L(()=>{"use strict";Ri=()=>typeof document>"u"?new URL(`file:${__filename}`).href:document.currentScript&&document.currentScript.src||new URL("main.js",document.baseURI).href,w=Ri()});var H,We=L(()=>{"use strict";m();H=class{constructor(e){this.dataDir=e}async syncToFs(e,t){}async initialSyncFs(e){}async close(e){}}});var Qe=Z((Ca,M)=>{"use strict";m();var ln=9007199254740991,pn=function(r){return r}();function Ui(r){return r===pn}function fn(r){return typeof r=="string"||Object.prototype.toString.call(r)=="[object String]"}function ki(r){return Object.prototype.toString.call(r)=="[object Date]"}function St(r){return r!==null&&typeof r=="object"}function Ft(r){return typeof r=="function"}function vi(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=ln}function Li(r){return Object.prototype.toString.call(r)=="[object Array]"}function dn(r){return St(r)&&!Ft(r)&&vi(r.length)}function er(r){return Object.prototype.toString.call(r)=="[object ArrayBuffer]"}function zi(r,e){return Array.prototype.map.call(r,e)}function ji(r,e){var t=pn;return Ft(e)&&Array.prototype.every.call(r,function(n,i,s){var o=e(n,i,s);return o&&(t=n),!o}),t}function Gi(r){return Object.assign.apply(null,arguments)}function hn(r){var e,t,n;if(fn(r)){for(t=r.length,n=new Uint8Array(t),e=0;e<t;e++)n[e]=r.charCodeAt(e)&255;return n}return er(r)?new Uint8Array(r):St(r)&&er(r.buffer)?new Uint8Array(r.buffer):dn(r)?new Uint8Array(r):St(r)&&Ft(r.toString)?hn(r.toString()):new Uint8Array}M.exports.MAX_SAFE_INTEGER=ln;M.exports.isUndefined=Ui;M.exports.isString=fn;M.exports.isObject=St;M.exports.isDateTime=ki;M.exports.isFunction=Ft;M.exports.isArray=Li;M.exports.isArrayLike=dn;M.exports.isArrayBuffer=er;M.exports.map=zi;M.exports.find=ji;M.exports.extend=Gi;M.exports.toUint8Array=hn});var Ve=Z((ka,mn)=>{"use strict";m();var tr="\0";mn.exports={NULL_CHAR:tr,TMAGIC:"ustar"+tr+"00",OLDGNU_MAGIC:"ustar  "+tr,REGTYPE:0,LNKTYPE:1,SYMTYPE:2,CHRTYPE:3,BLKTYPE:4,DIRTYPE:5,FIFOTYPE:6,CONTTYPE:7,TSUID:parseInt("4000",8),TSGID:parseInt("2000",8),TSVTX:parseInt("1000",8),TUREAD:parseInt("0400",8),TUWRITE:parseInt("0200",8),TUEXEC:parseInt("0100",8),TGREAD:parseInt("0040",8),TGWRITE:parseInt("0020",8),TGEXEC:parseInt("0010",8),TOREAD:parseInt("0004",8),TOWRITE:parseInt("0002",8),TOEXEC:parseInt("0001",8),TPERMALL:parseInt("0777",8),TPERMMASK:parseInt("0777",8)}});var ir=Z((La,_)=>{"use strict";m();var yn=Qe(),P=Ve(),Hi=512,rr=P.TPERMALL,gn=0,wn=0,nr=[["name",100,0,function(r,e){return Ye(r[e[0]],e[1])},function(r,e,t){return he(r.slice(e,e+t[1]))}],["mode",8,100,function(r,e){var t=r[e[0]]||rr;return t=t&P.TPERMMASK,De(t,e[1],rr)},function(r,e,t){var n=ee(r.slice(e,e+t[1]));return n&=P.TPERMMASK,n}],["uid",8,108,function(r,e){return De(r[e[0]],e[1],gn)},function(r,e,t){return ee(r.slice(e,e+t[1]))}],["gid",8,116,function(r,e){return De(r[e[0]],e[1],wn)},function(r,e,t){return ee(r.slice(e,e+t[1]))}],["size",12,124,function(r,e){return De(r.data.length,e[1])},function(r,e,t){return ee(r.slice(e,e+t[1]))}],["modifyTime",12,136,function(r,e){return Tt(r[e[0]],e[1])},function(r,e,t){return Bt(r.slice(e,e+t[1]))}],["checksum",8,148,function(r,e){return"        "},function(r,e,t){return ee(r.slice(e,e+t[1]))}],["type",1,156,function(r,e){return""+(parseInt(r[e[0]],10)||0)%8},function(r,e,t){return(parseInt(String.fromCharCode(r[e]),10)||0)%8}],["linkName",100,157,function(r,e){return""},function(r,e,t){return he(r.slice(e,e+t[1]))}],["ustar",8,257,function(r,e){return P.TMAGIC},function(r,e,t){return qi(he(r.slice(e,e+t[1]),!0))},function(r,e){return r[e[0]]==P.TMAGIC||r[e[0]]==P.OLDGNU_MAGIC}],["owner",32,265,function(r,e){return Ye(r[e[0]],e[1])},function(r,e,t){return he(r.slice(e,e+t[1]))}],["group",32,297,function(r,e){return Ye(r[e[0]],e[1])},function(r,e,t){return he(r.slice(e,e+t[1]))}],["majorNumber",8,329,function(r,e){return""},function(r,e,t){return ee(r.slice(e,e+t[1]))}],["minorNumber",8,337,function(r,e){return""},function(r,e,t){return ee(r.slice(e,e+t[1]))}],["prefix",131,345,function(r,e){return Ye(r[e[0]],e[1])},function(r,e,t){return he(r.slice(e,e+t[1]))}],["accessTime",12,476,function(r,e){return Tt(r[e[0]],e[1])},function(r,e,t){return Bt(r.slice(e,e+t[1]))}],["createTime",12,488,function(r,e){return Tt(r[e[0]],e[1])},function(r,e,t){return Bt(r.slice(e,e+t[1]))}]],bn=function(r){var e=r[r.length-1];return e[2]+e[1]}(nr);function qi(r){if(r.length==8){var e=r.split("");if(e[5]==P.NULL_CHAR)return(e[6]==" "||e[6]==P.NULL_CHAR)&&(e[6]="0"),(e[7]==" "||e[7]==P.NULL_CHAR)&&(e[7]="0"),e=e.join(""),e==P.TMAGIC?e:r;if(e[7]==P.NULL_CHAR)return e[5]==P.NULL_CHAR&&(e[5]=" "),e[6]==P.NULL_CHAR&&(e[6]=" "),e==P.OLDGNU_MAGIC?e:r}return r}function Ye(r,e){return e-=1,yn.isUndefined(r)&&(r=""),r=(""+r).substr(0,e),r+P.NULL_CHAR}function De(r,e,t){for(t=parseInt(t)||0,e-=1,r=(parseInt(r)||t).toString(8).substr(-e,e);r.length<e;)r="0"+r;return r+P.NULL_CHAR}function Tt(r,e){if(yn.isDateTime(r))r=Math.floor(1*r/1e3);else if(r=parseInt(r,10),isFinite(r)){if(r<=0)return""}else r=Math.floor(1*new Date/1e3);return De(r,e,0)}function he(r,e){var t=String.fromCharCode.apply(null,r);if(e)return t;var n=t.indexOf(P.NULL_CHAR);return n>=0?t.substr(0,n):t}function ee(r){var e=String.fromCharCode.apply(null,r);return parseInt(e.replace(/^0+$/g,""),8)||0}function Bt(r){return r.length==0||r[0]==0?null:new Date(1e3*ee(r))}function $i(r,e,t){var n=parseInt(e,10)||0,i=Math.min(n+bn,r.length),s=0,o=0,a=0;t&&nr.every(function(h){return h[0]=="checksum"?(o=n+h[2],a=o+h[1],!1):!0});for(var u=32,c=n;c<i;c++){var f=c>=o&&c<a?u:r[c];s=(s+f)%262144}return s}_.exports.recordSize=Hi;_.exports.defaultFileMode=rr;_.exports.defaultUid=gn;_.exports.defaultGid=wn;_.exports.posixHeader=nr;_.exports.effectiveHeaderSize=bn;_.exports.calculateChecksum=$i;_.exports.formatTarString=Ye;_.exports.formatTarNumber=De;_.exports.formatTarDateTime=Tt;_.exports.parseTarString=he;_.exports.parseTarNumber=ee;_.exports.parseTarDateTime=Bt});var Fn=Z((ja,Sn)=>{"use strict";m();var Wi=Ve(),It=Qe(),ie=ir();function xn(r){return ie.recordSize}function En(r){return Math.ceil(r.data.length/ie.recordSize)*ie.recordSize}function Qi(r){var e=0;return r.forEach(function(t){e+=xn(t)+En(t)}),e+=ie.recordSize*2,new Uint8Array(e)}function Vi(r,e,t){t=parseInt(t)||0;var n=t;ie.posixHeader.forEach(function(u){for(var c=u[3](e,u),f=c.length,h=0;h<f;h+=1)r[n+h]=c.charCodeAt(h)&255;n+=u[1]});var i=It.find(ie.posixHeader,function(u){return u[0]=="checksum"});if(i){var s=ie.calculateChecksum(r,t,!0),o=ie.formatTarNumber(s,i[1]-2)+Wi.NULL_CHAR+" ";n=t+i[2];for(var a=0;a<o.length;a+=1)r[n]=o.charCodeAt(a)&255,n++}return t+xn(e)}function Yi(r,e,t){return t=parseInt(t,10)||0,r.set(e.data,t),t+En(e)}function Ki(r){r=It.map(r,function(n){return It.extend({},n,{data:It.toUint8Array(n.data)})});var e=Qi(r),t=0;return r.forEach(function(n){t=Vi(e,n,t),t=Yi(e,n,t)}),e}Sn.exports.tar=Ki});var Bn=Z((Ha,Tn)=>{"use strict";m();var Xi=Ve(),or=Qe(),q=ir(),Ji={extractData:!0,checkHeader:!0,checkChecksum:!0,checkFileSize:!0},Zi={size:!0,checksum:!0,ustar:!0},sr={unexpectedEndOfFile:"Unexpected end of file.",fileCorrupted:"File is corrupted.",checksumCheckFailed:"Checksum check failed."};function es(r){return q.recordSize}function ts(r){return Math.ceil(r/q.recordSize)*q.recordSize}function rs(r,e){for(var t=e,n=Math.min(r.length,e+q.recordSize*2),i=t;i<n;i++)if(r[i]!=0)return!1;return!0}function ns(r,e,t){if(r.length-e<q.recordSize){if(t.checkFileSize)throw new Error(sr.unexpectedEndOfFile);return null}e=parseInt(e)||0;var n={},i=e;if(q.posixHeader.forEach(function(a){n[a[0]]=a[4](r,i,a),i+=a[1]}),n.type!=0&&(n.size=0),t.checkHeader&&q.posixHeader.forEach(function(a){if(or.isFunction(a[5])&&!a[5](n,a)){var u=new Error(sr.fileCorrupted);throw u.data={offset:e+a[2],field:a[0]},u}}),t.checkChecksum){var s=q.calculateChecksum(r,e,!0);if(s!=n.checksum){var o=new Error(sr.checksumCheckFailed);throw o.data={offset:e,header:n,checksum:s},o}}return n}function is(r,e,t,n){return n.extractData?t.size<=0?new Uint8Array:r.slice(e,e+t.size):null}function ss(r,e){var t={};return q.posixHeader.forEach(function(n){var i=n[0];Zi[i]||(t[i]=r[i])}),t.isOldGNUFormat=r.ustar==Xi.OLDGNU_MAGIC,e&&(t.data=e),t}function os(r,e){e=or.extend({},Ji,e);for(var t=[],n=0,i=r.length;i-n>=q.recordSize;){r=or.toUint8Array(r);var s=ns(r,n,e);if(!s)break;n+=es(s);var o=is(r,n,s,e);if(t.push(ss(s,o)),n+=ts(s.size),rs(r,n))break}return t}Tn.exports.untar=os});var ar=Z(($a,In)=>{"use strict";m();var as=Qe(),us=Ve(),cs=Fn(),ls=Bn();as.extend(In.exports,cs,ls,us)});async function se(r,e,t="auto"){let n=ds(r,R),[i,s]=await hs(n,t),o=(e||"pgdata")+(s?".tar.gz":".tar"),a=s?"application/x-gzip":"application/x-tar";return typeof File<"u"?new File([i],o,{type:a}):new Blob([i],{type:a})}async function An(r,e){let t=new Uint8Array(await e.arrayBuffer()),n=typeof File<"u"&&e instanceof File?e.name:void 0;(ps.includes(e.type)||n?.endsWith(".tgz")||n?.endsWith(".tar.gz"))&&(t=await gs(t));let s=(0,$.untar)(t);for(let o of s){let a=R+o.name,u=a.split("/").slice(0,-1);for(let c=1;c<=u.length;c++){let f=u.slice(0,c).join("/");r.analyzePath(f).exists||r.mkdir(f)}o.type===$.REGTYPE?(r.writeFile(a,o.data),r.utime(a,Pn(o.modifyTime),Pn(o.modifyTime))):o.type===$.DIRTYPE&&r.mkdir(a)}}function fs(r,e){let t=[],n=i=>{r.readdir(i).forEach(o=>{if(o==="."||o==="..")return;let a=i+"/"+o,u=r.stat(a),c=r.isFile(u.mode)?r.readFile(a,{encoding:"binary"}):new Uint8Array(0);t.push({name:a.substring(e.length),mode:u.mode,size:u.size,type:r.isFile(u.mode)?$.REGTYPE:$.DIRTYPE,modifyTime:u.mtime,data:c}),r.isDir(u.mode)&&n(a)})};return n(e),t}function ds(r,e){let t=fs(r,e);return(0,$.tar)(t)}async function hs(r,e="auto"){if(e==="none")return[r,!1];if(typeof CompressionStream<"u")return[await ms(r),!0];if(typeof process<"u"&&process.versions&&process.versions.node)return[await ys(r),!0];if(e==="auto")return[r,!1];throw new Error("Compression not supported in this environment")}async function ms(r){let e=new CompressionStream("gzip"),t=e.writable.getWriter(),n=e.readable.getReader();t.write(r),t.close();let i=[];for(;;){let{value:a,done:u}=await n.read();if(u)break;a&&i.push(a)}let s=new Uint8Array(i.reduce((a,u)=>a+u.length,0)),o=0;return i.forEach(a=>{s.set(a,o),o+=a.length}),s}async function ys(r){let{promisify:e}=await import("util"),{gzip:t}=await import("zlib");return await e(t)(r)}async function gs(r){if(typeof CompressionStream<"u")return await ws(r);if(typeof process<"u"&&process.versions&&process.versions.node)return await bs(r);throw new Error("Unsupported environment for decompression")}async function ws(r){let e=new DecompressionStream("gzip"),t=e.writable.getWriter(),n=e.readable.getReader();t.write(r),t.close();let i=[];for(;;){let{value:a,done:u}=await n.read();if(u)break;a&&i.push(a)}let s=new Uint8Array(i.reduce((a,u)=>a+u.length,0)),o=0;return i.forEach(a=>{s.set(a,o),o+=a.length}),s}async function bs(r){let{promisify:e}=await import("util"),{gunzip:t}=await import("zlib");return await e(t)(r)}function Pn(r){return r?typeof r=="number"?r:Math.floor(r.getTime()/1e3):Math.floor(Date.now()/1e3)}var $,ps,Oe=L(()=>{"use strict";m();$=N(ar(),1);me();ps=["application/x-gtar","application/x-tar+gzip","application/x-gzip","application/gzip"]});var Ne,ur=L(()=>{"use strict";m();We();me();Oe();Ne=class extends H{async emscriptenOpts(e){return{...e,preRun:[...e.preRun||[],n=>{let i=n.FS.filesystems.IDBFS;n.FS.mkdir("/pglite"),n.FS.mkdir(`/pglite/${this.dataDir}`),n.FS.mount(i,{},`/pglite/${this.dataDir}`),n.FS.symlink(`/pglite/${this.dataDir}`,R)}]}}initialSyncFs(e){return new Promise((t,n)=>{e.syncfs(!0,i=>{i?n(i):t()})})}syncToFs(e,t){return new Promise((n,i)=>{e.syncfs(!1,s=>{s?i(s):n()})})}async dumpTar(e,t,n){return se(e,t,n)}async close(e){let t=e.filesystems.IDBFS.dbs[this.dataDir];t&&t.close(),e.quit()}}});var Re,cr=L(()=>{"use strict";m();We();Oe();Re=class extends H{async emscriptenOpts(e){return e}async dumpTar(e,t,n){return se(e,t,n)}async close(e){e.quit()}}});var Dn={};de(Dn,{NodeFS:()=>lr});var Pt,At,lr,On=L(()=>{"use strict";m();Pt=N(require("fs"),1),At=N(require("path"),1);We();me();Oe();lr=class extends H{constructor(e){super(e),this.rootDir=At.resolve(e),Pt.existsSync(At.join(this.rootDir))||Pt.mkdirSync(this.rootDir)}async emscriptenOpts(e){return{...e,preRun:[...e.preRun||[],n=>{let i=n.FS.filesystems.NODEFS;n.FS.mkdir(R),n.FS.mount(i,{root:this.rootDir},R)}]}}async dumpTar(e,t,n){return se(e,t,n)}async close(e){e.quit()}}});var Dt,S,pr=L(()=>{"use strict";m();Dt={EBADF:8,EBADFD:127,EEXIST:20,EINVAL:28,EISDIR:31,ENODEV:43,ENOENT:44,ENOTDIR:54,ENOTEMPTY:55},S=class extends Error{constructor(e,t){super(t),typeof e=="number"?this.code=e:typeof e=="string"&&(this.code=Dt[e])}}});function F(...r){}var Nn,Rn=L(()=>{"use strict";m();pr();Nn=(r,e)=>{let t=r.FS,n={tryFSOperation(i){try{return i()}catch(s){throw s.code?s.code==="UNKNOWN"?new t.ErrnoError(Dt.EINVAL):new t.ErrnoError(s.code):s}},mount(i){return n.createNode(null,"/",16895,0)},syncfs(i,s,o){},createNode(i,s,o,a){if(!t.isDir(o)&&!t.isFile(o))throw new t.ErrnoError(28);let u=t.createNode(i,s,o);return u.node_ops=n.node_ops,u.stream_ops=n.stream_ops,u},getMode:function(i){return F("getMode",i),n.tryFSOperation(()=>e.lstat(i).mode)},realPath:function(i){let s=[];for(;i.parent!==i;)s.push(i.name),i=i.parent;return s.push(i.mount.opts.root),s.reverse(),s.join("/")},node_ops:{getattr(i){F("getattr",n.realPath(i));let s=n.realPath(i);return n.tryFSOperation(()=>{let o=e.lstat(s);return{...o,dev:0,ino:i.id,nlink:1,rdev:i.rdev,atime:new Date(o.atime),mtime:new Date(o.mtime),ctime:new Date(o.ctime)}})},setattr(i,s){F("setattr",n.realPath(i),s);let o=n.realPath(i);n.tryFSOperation(()=>{s.mode!==void 0&&e.chmod(o,s.mode),s.size!==void 0&&e.truncate(o,s.size),s.timestamp!==void 0&&e.utimes(o,s.timestamp,s.timestamp),s.size!==void 0&&e.truncate(o,s.size)})},lookup(i,s){F("lookup",n.realPath(i),s);let o=[n.realPath(i),s].join("/"),a=n.getMode(o);return n.createNode(i,s,a)},mknod(i,s,o,a){F("mknod",n.realPath(i),s,o,a);let u=n.createNode(i,s,o,a),c=n.realPath(u);return n.tryFSOperation(()=>(t.isDir(u.mode)?e.mkdir(c,{mode:o}):e.writeFile(c,"",{mode:o}),u))},rename(i,s,o){F("rename",n.realPath(i),n.realPath(s),o);let a=n.realPath(i),u=[n.realPath(s),o].join("/");n.tryFSOperation(()=>{e.rename(a,u)}),i.name=o},unlink(i,s){F("unlink",n.realPath(i),s);let o=[n.realPath(i),s].join("/");try{e.unlink(o)}catch{}},rmdir(i,s){F("rmdir",n.realPath(i),s);let o=[n.realPath(i),s].join("/");return n.tryFSOperation(()=>{e.rmdir(o)})},readdir(i){F("readdir",n.realPath(i));let s=n.realPath(i);return n.tryFSOperation(()=>e.readdir(s))},symlink(i,s,o){throw F("symlink",n.realPath(i),s,o),new t.ErrnoError(63)},readlink(i){throw F("readlink",n.realPath(i)),new t.ErrnoError(63)}},stream_ops:{open(i){F("open stream",n.realPath(i.node));let s=n.realPath(i.node);return n.tryFSOperation(()=>{t.isFile(i.node.mode)&&(i.shared.refcount=1,i.nfd=e.open(s))})},close(i){return F("close stream",n.realPath(i.node)),n.tryFSOperation(()=>{t.isFile(i.node.mode)&&i.nfd&&--i.shared.refcount===0&&e.close(i.nfd)})},dup(i){F("dup stream",n.realPath(i.node)),i.shared.refcount++},read(i,s,o,a,u){return F("read stream",n.realPath(i.node),o,a,u),a===0?0:n.tryFSOperation(()=>e.read(i.nfd,s,o,a,u))},write(i,s,o,a,u){return F("write stream",n.realPath(i.node),o,a,u),n.tryFSOperation(()=>e.write(i.nfd,s.buffer,o,a,u))},llseek(i,s,o){F("llseek stream",n.realPath(i.node),s,o);let a=s;if(o===1?a+=i.position:o===2&&t.isFile(i.node.mode)&&n.tryFSOperation(()=>{let u=e.fstat(i.nfd);a+=u.size}),a<0)throw new t.ErrnoError(28);return a},mmap(i,s,o,a,u){if(F("mmap stream",n.realPath(i.node),s,o,a,u),!t.isFile(i.node.mode))throw new t.ErrnoError(Dt.ENODEV);let c=r.mmapAlloc(s);return n.stream_ops.read(i,r.HEAP8,c,s,o),{ptr:c,allocated:!0}},msync(i,s,o,a,u){return F("msync stream",n.realPath(i.node),o,a,u),n.stream_ops.write(i,s,0,a,o),0}}};return n}});var xs,Es,fr,Xe,Je,_e,ge,Ze,A,te,O,et,oe,ae,Q,y,Mn,ye,Me,W,D,Ke,_n,dr,hr,Ot,Cn=L(()=>{"use strict";m();pr();xs="state.txt",Es="data",fr={DIR:16384,FILE:32768},hr=class hr{constructor({root:e,initialPoolSize:t,maintainedPoolSize:n}){b(this,y);b(this,Xe,!1);b(this,Je);b(this,_e);b(this,ge);b(this,Ze);b(this,A);b(this,te,new Map);b(this,O,new Map);b(this,et,0);b(this,oe,new Map);b(this,ae,new Map);this.lastCheckpoint=0;this.checkpointInterval=1e3*60;this.poolCounter=0;b(this,Q,new Set);this.root=e,this.initialPoolSize=t||1e3,this.maintainedPoolSize=n||100,this.readyPromise=d(this,y,Mn).call(this)}static async create(e){let t=new hr(e);return await t.readyPromise,t}get ready(){return p(this,Xe)}async maintainPool(e){e=e||this.maintainedPoolSize;let t=e-this.state.pool.length,n=[];for(let i=0;i<t;i++)n.push(new Promise(async s=>{++this.poolCounter;let o=`${(Date.now()-1704063600).toString(16).padStart(8,"0")}-${this.poolCounter.toString(16).padStart(8,"0")}`,a=await p(this,ge).getFileHandle(o,{create:!0}),u=await a.createSyncAccessHandle();p(this,te).set(o,a),p(this,O).set(o,u),d(this,y,Me).call(this,{opp:"createPoolFile",args:[o]}),this.state.pool.push(o),s()}));for(let i=0;i>t;i--)n.push(new Promise(async s=>{let o=this.state.pool.pop();d(this,y,Me).call(this,{opp:"deletePoolFile",args:[o]});let a=p(this,te).get(o);p(this,O).get(o)?.close(),await a.remove().then(()=>{p(this,te).delete(o),p(this,O).delete(o),s()})}));await Promise.all(n)}_createPoolFileState(e){this.state.pool.push(e)}_deletePoolFileState(e){let t=this.state.pool.indexOf(e);t>-1&&this.state.pool.splice(t,1)}async maybeCheckpointState(){Date.now()-this.lastCheckpoint>this.checkpointInterval&&await this.checkpointState()}async checkpointState(){let e=new TextEncoder().encode(JSON.stringify(this.state));p(this,A).truncate(0),p(this,A).write(e,{at:0}),p(this,A).flush(),this.lastCheckpoint=Date.now()}flush(){for(let e of p(this,Q))try{e.flush()}catch{}p(this,Q).clear()}exit(){for(let e of p(this,O).values())e.close();p(this,A).flush(),p(this,A).close()}chmod(e,t){d(this,y,ye).call(this,{opp:"chmod",args:[e,t]},()=>{this._chmodState(e,t)})}_chmodState(e,t){let n=d(this,y,D).call(this,e);n.mode=t}close(e){let t=d(this,y,Ke).call(this,e);p(this,oe).delete(e),p(this,ae).delete(t)}fstat(e){let t=d(this,y,Ke).call(this,e);return this.lstat(t)}lstat(e){let t=d(this,y,D).call(this,e),n=t.type==="file"?p(this,O).get(t.backingFilename).getSize():0,i=4096;return{dev:0,ino:0,mode:t.mode,nlink:1,uid:0,gid:0,rdev:0,size:n,blksize:i,blocks:Math.ceil(n/i),atime:t.lastModified,mtime:t.lastModified,ctime:t.lastModified}}mkdir(e,t){d(this,y,ye).call(this,{opp:"mkdir",args:[e,t]},()=>{this._mkdirState(e,t)})}_mkdirState(e,t){let n=d(this,y,W).call(this,e),i=n.pop(),s=[],o=this.state.root;for(let u of n){if(s.push(e),!Object.prototype.hasOwnProperty.call(o.children,u))if(t?.recursive)this.mkdir(s.join("/"));else throw new S("ENOENT","No such file or directory");if(o.children[u].type!=="directory")throw new S("ENOTDIR","Not a directory");o=o.children[u]}if(Object.prototype.hasOwnProperty.call(o.children,i))throw new S("EEXIST","File exists");let a={type:"directory",lastModified:Date.now(),mode:t?.mode||fr.DIR,children:{}};o.children[i]=a}open(e,t,n){if(d(this,y,D).call(this,e).type!=="file")throw new S("EISDIR","Is a directory");let s=d(this,y,_n).call(this);return p(this,oe).set(s,e),p(this,ae).set(e,s),s}readdir(e){let t=d(this,y,D).call(this,e);if(t.type!=="directory")throw new S("ENOTDIR","Not a directory");return Object.keys(t.children)}read(e,t,n,i,s){let o=d(this,y,Ke).call(this,e),a=d(this,y,D).call(this,o);if(a.type!=="file")throw new S("EISDIR","Is a directory");return p(this,O).get(a.backingFilename).read(new Int8Array(t.buffer,n,i),{at:s})}rename(e,t){d(this,y,ye).call(this,{opp:"rename",args:[e,t]},()=>{this._renameState(e,t,!0)})}_renameState(e,t,n=!1){let i=d(this,y,W).call(this,e),s=i.pop(),o=d(this,y,D).call(this,i.join("/"));if(!Object.prototype.hasOwnProperty.call(o.children,s))throw new S("ENOENT","No such file or directory");let a=d(this,y,W).call(this,t),u=a.pop(),c=d(this,y,D).call(this,a.join("/"));if(n&&Object.prototype.hasOwnProperty.call(c.children,u)){let f=c.children[u];p(this,O).get(f.backingFilename).truncate(0),this.state.pool.push(f.backingFilename)}c.children[u]=o.children[s],delete o.children[s]}rmdir(e){d(this,y,ye).call(this,{opp:"rmdir",args:[e]},()=>{this._rmdirState(e)})}_rmdirState(e){let t=d(this,y,W).call(this,e),n=t.pop(),i=d(this,y,D).call(this,t.join("/"));if(!Object.prototype.hasOwnProperty.call(i.children,n))throw new S("ENOENT","No such file or directory");let s=i.children[n];if(s.type!=="directory")throw new S("ENOTDIR","Not a directory");if(Object.keys(s.children).length>0)throw new S("ENOTEMPTY","Directory not empty");delete i.children[n]}truncate(e,t=0){let n=d(this,y,D).call(this,e);if(n.type!=="file")throw new S("EISDIR","Is a directory");let i=p(this,O).get(n.backingFilename);if(!i)throw new S("ENOENT","No such file or directory");i.truncate(t),p(this,Q).add(i)}unlink(e){d(this,y,ye).call(this,{opp:"unlink",args:[e]},()=>{this._unlinkState(e,!0)})}_unlinkState(e,t=!1){let n=d(this,y,W).call(this,e),i=n.pop(),s=d(this,y,D).call(this,n.join("/"));if(!Object.prototype.hasOwnProperty.call(s.children,i))throw new S("ENOENT","No such file or directory");let o=s.children[i];if(o.type!=="file")throw new S("EISDIR","Is a directory");if(delete s.children[i],t){let a=p(this,O).get(o.backingFilename);a?.truncate(0),p(this,Q).add(a),p(this,ae).has(e)&&(p(this,oe).delete(p(this,ae).get(e)),p(this,ae).delete(e))}this.state.pool.push(o.backingFilename)}utimes(e,t,n){d(this,y,ye).call(this,{opp:"utimes",args:[e,t,n]},()=>{this._utimesState(e,t,n)})}_utimesState(e,t,n){let i=d(this,y,D).call(this,e);i.lastModified=n}writeFile(e,t,n){let i=d(this,y,W).call(this,e),s=i.pop(),o=d(this,y,D).call(this,i.join("/"));if(Object.prototype.hasOwnProperty.call(o.children,s)){let c=o.children[s];c.lastModified=Date.now(),d(this,y,Me).call(this,{opp:"setLastModified",args:[e,c.lastModified]})}else{if(this.state.pool.length===0)throw new Error("No more file handles available in the pool");let c={type:"file",lastModified:Date.now(),mode:n?.mode||fr.FILE,backingFilename:this.state.pool.pop()};o.children[s]=c,d(this,y,Me).call(this,{opp:"createFileNode",args:[e,c]})}let a=o.children[s],u=p(this,O).get(a.backingFilename);t.length>0&&(u.write(typeof t=="string"?new TextEncoder().encode(t):new Int8Array(t),{at:0}),e.startsWith("/pg_wal")&&p(this,Q).add(u))}_createFileNodeState(e,t){let n=d(this,y,W).call(this,e),i=n.pop(),s=d(this,y,D).call(this,n.join("/"));s.children[i]=t;let o=this.state.pool.indexOf(t.backingFilename);return o>-1&&this.state.pool.splice(o,1),t}_setLastModifiedState(e,t){let n=d(this,y,D).call(this,e);n.lastModified=t}write(e,t,n,i,s){let o=d(this,y,Ke).call(this,e),a=d(this,y,D).call(this,o);if(a.type!=="file")throw new S("EISDIR","Is a directory");let u=p(this,O).get(a.backingFilename);if(!u)throw new S("EBADF","Bad file descriptor");let c=u.write(new Int8Array(t,n,i),{at:s});return o.startsWith("/pg_wal")&&p(this,Q).add(u),c}};Xe=new WeakMap,Je=new WeakMap,_e=new WeakMap,ge=new WeakMap,Ze=new WeakMap,A=new WeakMap,te=new WeakMap,O=new WeakMap,et=new WeakMap,oe=new WeakMap,ae=new WeakMap,Q=new WeakMap,y=new WeakSet,Mn=async function(){x(this,Je,await navigator.storage.getDirectory()),x(this,_e,await d(this,y,dr).call(this,this.root,{create:!0})),x(this,ge,await d(this,y,dr).call(this,Es,{from:p(this,_e),create:!0})),x(this,Ze,await p(this,_e).getFileHandle(xs,{create:!0})),x(this,A,await p(this,Ze).createSyncAccessHandle());let e=new ArrayBuffer(p(this,A).getSize());p(this,A).read(e,{at:0});let t,n=new TextDecoder().decode(e).split(`
`),i=!1;try{t=JSON.parse(n[0])}catch{t={root:{type:"directory",lastModified:Date.now(),mode:fr.DIR,children:{}},pool:[]},p(this,A).truncate(0),p(this,A).write(new TextEncoder().encode(JSON.stringify(t)),{at:0}),i=!0}this.state=t;let s=n.slice(1).filter(Boolean).map(c=>JSON.parse(c));for(let c of s){let f=`_${c.opp}State`;if(typeof this[f]=="function")try{this[f].bind(this)(...c.args)}catch(h){console.warn("Error applying OPFS AHP WAL entry",c,h)}}let o=[],a=async c=>{if(c.type==="file")try{let f=await p(this,ge).getFileHandle(c.backingFilename),h=await f.createSyncAccessHandle();p(this,te).set(c.backingFilename,f),p(this,O).set(c.backingFilename,h)}catch(f){console.error("Error opening file handle for node",c,f)}else for(let f of Object.values(c.children))o.push(a(f))};await a(this.state.root);let u=[];for(let c of this.state.pool)u.push(new Promise(async f=>{p(this,te).has(c)&&console.warn("File handle already exists for pool file",c);let h=await p(this,ge).getFileHandle(c),T=await h.createSyncAccessHandle();p(this,te).set(c,h),p(this,O).set(c,T),f()}));await Promise.all([...o,...u]),await this.maintainPool(i?this.initialPoolSize:this.maintainedPoolSize),x(this,Xe,!0)},ye=function(e,t){let n=d(this,y,Me).call(this,e);try{t()}catch(i){throw p(this,A).truncate(n),i}},Me=function(e){let t=JSON.stringify(e),n=new TextEncoder().encode(`
${t}`),i=p(this,A).getSize();return p(this,A).write(n,{at:i}),p(this,Q).add(p(this,A)),i},W=function(e){return e.split("/").filter(Boolean)},D=function(e,t){let n=d(this,y,W).call(this,e),i=t||this.state.root;for(let s of n){if(i.type!=="directory")throw new S("ENOTDIR","Not a directory");if(!Object.prototype.hasOwnProperty.call(i.children,s))throw new S("ENOENT","No such file or directory");i=i.children[s]}return i},Ke=function(e){let t=p(this,oe).get(e);if(!t)throw new S("EBADF","Bad file descriptor");return t},_n=function(){let e=++Jt(this,et)._;for(;p(this,oe).has(e);)Jt(this,et)._++;return e},dr=async function(e,t){let n=d(this,y,W).call(this,e),i=t?.from||p(this,Je);for(let s of n)i=await i.getDirectoryHandle(s,{create:t?.create});return i};Ot=hr});var Un={};de(Un,{OpfsAhpFS:()=>mr});var tt,rt,mr,kn=L(()=>{"use strict";m();We();me();Rn();Cn();Oe();mr=class extends H{constructor(t,{initialPoolSize:n,maintainedPoolSize:i}={}){super(t);b(this,tt);b(this,rt);x(this,tt,n??1e3),x(this,rt,i??100)}async emscriptenOpts(t){return this.opfsAhp=await Ot.create({root:this.dataDir,initialPoolSize:p(this,tt),maintainedPoolSize:p(this,rt)}),{...t,preRun:[...t.preRun||[],i=>{let s=Nn(i,this.opfsAhp);i.FS.mkdir(R),i.FS.mount(s,{},R)}]}}async syncToFs(t,n=!1){await this.opfsAhp?.maybeCheckpointState(),await this.opfsAhp?.maintainPool(),n||this.opfsAhp?.flush()}async dumpTar(t,n,i){return se(t,n,i)}async close(t){this.opfsAhp?.exit(),t.quit()}};tt=new WeakMap,rt=new WeakMap});function vn(r){let e;if(r?.startsWith("file://")){if(r=r.slice(7),!r)throw new Error("Invalid dataDir, must be a valid path");e="nodefs"}else r?.startsWith("idb://")?(r=r.slice(6),e="idbfs"):r?.startsWith("opfs-ahp://")?(r=r.slice(11),e="opfs-ahp"):!r||r?.startsWith("memory://")?e="memoryfs":e="nodefs";return{dataDir:r,fsType:e}}async function Ln(r,e){let t;if(r&&e==="nodefs"){let{NodeFS:n}=await Promise.resolve().then(()=>(On(),Dn));t=new n(r)}else if(r&&e==="idbfs")t=new Ne(r);else if(r&&e==="opfs-ahp"){let{OpfsAhpFS:n}=await Promise.resolve().then(()=>(kn(),Un));t=new n(r)}else t=new Re;return t}var Nt,R,me=L(()=>{"use strict";m();ur();cr();Nt="/tmp/pglite",R=Nt+"/base"});var Wn=Z(Mt=>{"use strict";m();Mt.byteLength=Ts;Mt.toByteArray=Is;Mt.fromByteArray=Ds;var K=[],k=[],Fs=typeof Uint8Array<"u"?Uint8Array:Array,Pr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(xe=0,qn=Pr.length;xe<qn;++xe)K[xe]=Pr[xe],k[Pr.charCodeAt(xe)]=xe;var xe,qn;k[45]=62;k[95]=63;function $n(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function Ts(r){var e=$n(r),t=e[0],n=e[1];return(t+n)*3/4-n}function Bs(r,e,t){return(e+t)*3/4-t}function Is(r){var e,t=$n(r),n=t[0],i=t[1],s=new Fs(Bs(r,n,i)),o=0,a=i>0?n-4:n,u;for(u=0;u<a;u+=4)e=k[r.charCodeAt(u)]<<18|k[r.charCodeAt(u+1)]<<12|k[r.charCodeAt(u+2)]<<6|k[r.charCodeAt(u+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=k[r.charCodeAt(u)]<<2|k[r.charCodeAt(u+1)]>>4,s[o++]=e&255),i===1&&(e=k[r.charCodeAt(u)]<<10|k[r.charCodeAt(u+1)]<<4|k[r.charCodeAt(u+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function Ps(r){return K[r>>18&63]+K[r>>12&63]+K[r>>6&63]+K[r&63]}function As(r,e,t){for(var n,i=[],s=e;s<t;s+=3)n=(r[s]<<16&16711680)+(r[s+1]<<8&65280)+(r[s+2]&255),i.push(Ps(n));return i.join("")}function Ds(r){for(var e,t=r.length,n=t%3,i=[],s=16383,o=0,a=t-n;o<a;o+=s)i.push(As(r,o,o+s>a?a:o+s));return n===1?(e=r[t-1],i.push(K[e>>2]+K[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],i.push(K[e>>10]+K[e>>4&63]+K[e<<2&63]+"=")),i.join("")}});var Qn=Z(Ar=>{"use strict";m();Ar.read=function(r,e,t,n,i){var s,o,a=i*8-n-1,u=(1<<a)-1,c=u>>1,f=-7,h=t?i-1:0,T=t?-1:1,B=r[e+h];for(h+=T,s=B&(1<<-f)-1,B>>=-f,f+=a;f>0;s=s*256+r[e+h],h+=T,f-=8);for(o=s&(1<<-f)-1,s>>=-f,f+=n;f>0;o=o*256+r[e+h],h+=T,f-=8);if(s===0)s=1-c;else{if(s===u)return o?NaN:(B?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-c}return(B?-1:1)*o*Math.pow(2,s-n)};Ar.write=function(r,e,t,n,i,s){var o,a,u,c=s*8-i-1,f=(1<<c)-1,h=f>>1,T=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=n?0:s-1,U=n?1:-1,bt=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=f):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),o+h>=1?e+=T/u:e+=T*Math.pow(2,1-h),e*u>=2&&(o++,u/=2),o+h>=f?(a=0,o=f):o+h>=1?(a=(e*u-1)*Math.pow(2,i),o=o+h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;r[t+B]=a&255,B+=U,a/=256,i-=8);for(o=o<<i|a,c+=i;c>0;r[t+B]=o&255,B+=U,o/=256,c-=8);r[t+B-U]|=bt*128}});var li=Z(ve=>{"use strict";m();var Dr=Wn(),Ue=Qn(),Vn=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;ve.Buffer=l;ve.SlowBuffer=Cs;ve.INSPECT_MAX_BYTES=50;var _t=2147483647;ve.kMaxLength=_t;l.TYPED_ARRAY_SUPPORT=Os();!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function Os(){try{let r=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(r,e),r.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}});Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function re(r){if(r>_t)throw new RangeError('The value "'+r+'" is invalid for option "size"');let e=new Uint8Array(r);return Object.setPrototypeOf(e,l.prototype),e}function l(r,e,t){if(typeof r=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return Mr(r)}return Jn(r,e,t)}l.poolSize=8192;function Jn(r,e,t){if(typeof r=="string")return Rs(r,e);if(ArrayBuffer.isView(r))return Ms(r);if(r==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r);if(X(r,ArrayBuffer)||r&&X(r.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(X(r,SharedArrayBuffer)||r&&X(r.buffer,SharedArrayBuffer)))return Nr(r,e,t);if(typeof r=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let n=r.valueOf&&r.valueOf();if(n!=null&&n!==r)return l.from(n,e,t);let i=_s(r);if(i)return i;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof r[Symbol.toPrimitive]=="function")return l.from(r[Symbol.toPrimitive]("string"),e,t);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r)}l.from=function(r,e,t){return Jn(r,e,t)};Object.setPrototypeOf(l.prototype,Uint8Array.prototype);Object.setPrototypeOf(l,Uint8Array);function Zn(r){if(typeof r!="number")throw new TypeError('"size" argument must be of type number');if(r<0)throw new RangeError('The value "'+r+'" is invalid for option "size"')}function Ns(r,e,t){return Zn(r),r<=0?re(r):e!==void 0?typeof t=="string"?re(r).fill(e,t):re(r).fill(e):re(r)}l.alloc=function(r,e,t){return Ns(r,e,t)};function Mr(r){return Zn(r),re(r<0?0:_r(r)|0)}l.allocUnsafe=function(r){return Mr(r)};l.allocUnsafeSlow=function(r){return Mr(r)};function Rs(r,e){if((typeof e!="string"||e==="")&&(e="utf8"),!l.isEncoding(e))throw new TypeError("Unknown encoding: "+e);let t=ei(r,e)|0,n=re(t),i=n.write(r,e);return i!==t&&(n=n.slice(0,i)),n}function Or(r){let e=r.length<0?0:_r(r.length)|0,t=re(e);for(let n=0;n<e;n+=1)t[n]=r[n]&255;return t}function Ms(r){if(X(r,Uint8Array)){let e=new Uint8Array(r);return Nr(e.buffer,e.byteOffset,e.byteLength)}return Or(r)}function Nr(r,e,t){if(e<0||r.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(r.byteLength<e+(t||0))throw new RangeError('"length" is outside of buffer bounds');let n;return e===void 0&&t===void 0?n=new Uint8Array(r):t===void 0?n=new Uint8Array(r,e):n=new Uint8Array(r,e,t),Object.setPrototypeOf(n,l.prototype),n}function _s(r){if(l.isBuffer(r)){let e=_r(r.length)|0,t=re(e);return t.length===0||r.copy(t,0,0,e),t}if(r.length!==void 0)return typeof r.length!="number"||Ur(r.length)?re(0):Or(r);if(r.type==="Buffer"&&Array.isArray(r.data))return Or(r.data)}function _r(r){if(r>=_t)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+_t.toString(16)+" bytes");return r|0}function Cs(r){return+r!=r&&(r=0),l.alloc(+r)}l.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==l.prototype};l.compare=function(e,t){if(X(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),X(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,i=t.length;for(let s=0,o=Math.min(n,i);s<o;++s)if(e[s]!==t[s]){n=e[s],i=t[s];break}return n<i?-1:i<n?1:0};l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return l.alloc(0);let n;if(t===void 0)for(t=0,n=0;n<e.length;++n)t+=e[n].length;let i=l.allocUnsafe(t),s=0;for(n=0;n<e.length;++n){let o=e[n];if(X(o,Uint8Array))s+o.length>i.length?(l.isBuffer(o)||(o=l.from(o)),o.copy(i,s)):Uint8Array.prototype.set.call(i,o,s);else if(l.isBuffer(o))o.copy(i,s);else throw new TypeError('"list" argument must be an Array of Buffers');s+=o.length}return i};function ei(r,e){if(l.isBuffer(r))return r.length;if(ArrayBuffer.isView(r)||X(r,ArrayBuffer))return r.byteLength;if(typeof r!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof r);let t=r.length,n=arguments.length>2&&arguments[2]===!0;if(!n&&t===0)return 0;let i=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":return Rr(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return ci(r).length;default:if(i)return n?-1:Rr(r).length;e=(""+e).toLowerCase(),i=!0}}l.byteLength=ei;function Us(r,e,t){let n=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(r||(r="utf8");;)switch(r){case"hex":return Ws(this,e,t);case"utf8":case"utf-8":return ri(this,e,t);case"ascii":return qs(this,e,t);case"latin1":case"binary":return $s(this,e,t);case"base64":return Gs(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Qs(this,e,t);default:if(n)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),n=!0}}l.prototype._isBuffer=!0;function Ee(r,e,t){let n=r[e];r[e]=r[t],r[t]=n}l.prototype.swap16=function(){let e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)Ee(this,t,t+1);return this};l.prototype.swap32=function(){let e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)Ee(this,t,t+3),Ee(this,t+1,t+2);return this};l.prototype.swap64=function(){let e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)Ee(this,t,t+7),Ee(this,t+1,t+6),Ee(this,t+2,t+5),Ee(this,t+3,t+4);return this};l.prototype.toString=function(){let e=this.length;return e===0?"":arguments.length===0?ri(this,0,e):Us.apply(this,arguments)};l.prototype.toLocaleString=l.prototype.toString;l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:l.compare(this,e)===0};l.prototype.inspect=function(){let e="",t=ve.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"};Vn&&(l.prototype[Vn]=l.prototype.inspect);l.prototype.compare=function(e,t,n,i,s){if(X(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(t===void 0&&(t=0),n===void 0&&(n=e?e.length:0),i===void 0&&(i=0),s===void 0&&(s=this.length),t<0||n>e.length||i<0||s>this.length)throw new RangeError("out of range index");if(i>=s&&t>=n)return 0;if(i>=s)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,i>>>=0,s>>>=0,this===e)return 0;let o=s-i,a=n-t,u=Math.min(o,a),c=this.slice(i,s),f=e.slice(t,n);for(let h=0;h<u;++h)if(c[h]!==f[h]){o=c[h],a=f[h];break}return o<a?-1:a<o?1:0};function ti(r,e,t,n,i){if(r.length===0)return-1;if(typeof t=="string"?(n=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,Ur(t)&&(t=i?0:r.length-1),t<0&&(t=r.length+t),t>=r.length){if(i)return-1;t=r.length-1}else if(t<0)if(i)t=0;else return-1;if(typeof e=="string"&&(e=l.from(e,n)),l.isBuffer(e))return e.length===0?-1:Yn(r,e,t,n,i);if(typeof e=="number")return e=e&255,typeof Uint8Array.prototype.indexOf=="function"?i?Uint8Array.prototype.indexOf.call(r,e,t):Uint8Array.prototype.lastIndexOf.call(r,e,t):Yn(r,[e],t,n,i);throw new TypeError("val must be string, number or Buffer")}function Yn(r,e,t,n,i){let s=1,o=r.length,a=e.length;if(n!==void 0&&(n=String(n).toLowerCase(),n==="ucs2"||n==="ucs-2"||n==="utf16le"||n==="utf-16le")){if(r.length<2||e.length<2)return-1;s=2,o/=2,a/=2,t/=2}function u(f,h){return s===1?f[h]:f.readUInt16BE(h*s)}let c;if(i){let f=-1;for(c=t;c<o;c++)if(u(r,c)===u(e,f===-1?0:c-f)){if(f===-1&&(f=c),c-f+1===a)return f*s}else f!==-1&&(c-=c-f),f=-1}else for(t+a>o&&(t=o-a),c=t;c>=0;c--){let f=!0;for(let h=0;h<a;h++)if(u(r,c+h)!==u(e,h)){f=!1;break}if(f)return c}return-1}l.prototype.includes=function(e,t,n){return this.indexOf(e,t,n)!==-1};l.prototype.indexOf=function(e,t,n){return ti(this,e,t,n,!0)};l.prototype.lastIndexOf=function(e,t,n){return ti(this,e,t,n,!1)};function ks(r,e,t,n){t=Number(t)||0;let i=r.length-t;n?(n=Number(n),n>i&&(n=i)):n=i;let s=e.length;n>s/2&&(n=s/2);let o;for(o=0;o<n;++o){let a=parseInt(e.substr(o*2,2),16);if(Ur(a))return o;r[t+o]=a}return o}function vs(r,e,t,n){return Ct(Rr(e,r.length-t),r,t,n)}function Ls(r,e,t,n){return Ct(Xs(e),r,t,n)}function zs(r,e,t,n){return Ct(ci(e),r,t,n)}function js(r,e,t,n){return Ct(Js(e,r.length-t),r,t,n)}l.prototype.write=function(e,t,n,i){if(t===void 0)i="utf8",n=this.length,t=0;else if(n===void 0&&typeof t=="string")i=t,n=this.length,t=0;else if(isFinite(t))t=t>>>0,isFinite(n)?(n=n>>>0,i===void 0&&(i="utf8")):(i=n,n=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let s=this.length-t;if((n===void 0||n>s)&&(n=s),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let o=!1;for(;;)switch(i){case"hex":return ks(this,e,t,n);case"utf8":case"utf-8":return vs(this,e,t,n);case"ascii":case"latin1":case"binary":return Ls(this,e,t,n);case"base64":return zs(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return js(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}};l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Gs(r,e,t){return e===0&&t===r.length?Dr.fromByteArray(r):Dr.fromByteArray(r.slice(e,t))}function ri(r,e,t){t=Math.min(r.length,t);let n=[],i=e;for(;i<t;){let s=r[i],o=null,a=s>239?4:s>223?3:s>191?2:1;if(i+a<=t){let u,c,f,h;switch(a){case 1:s<128&&(o=s);break;case 2:u=r[i+1],(u&192)===128&&(h=(s&31)<<6|u&63,h>127&&(o=h));break;case 3:u=r[i+1],c=r[i+2],(u&192)===128&&(c&192)===128&&(h=(s&15)<<12|(u&63)<<6|c&63,h>2047&&(h<55296||h>57343)&&(o=h));break;case 4:u=r[i+1],c=r[i+2],f=r[i+3],(u&192)===128&&(c&192)===128&&(f&192)===128&&(h=(s&15)<<18|(u&63)<<12|(c&63)<<6|f&63,h>65535&&h<1114112&&(o=h))}}o===null?(o=65533,a=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|o&1023),n.push(o),i+=a}return Hs(n)}var Kn=4096;function Hs(r){let e=r.length;if(e<=Kn)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=Kn));return t}function qs(r,e,t){let n="";t=Math.min(r.length,t);for(let i=e;i<t;++i)n+=String.fromCharCode(r[i]&127);return n}function $s(r,e,t){let n="";t=Math.min(r.length,t);for(let i=e;i<t;++i)n+=String.fromCharCode(r[i]);return n}function Ws(r,e,t){let n=r.length;(!e||e<0)&&(e=0),(!t||t<0||t>n)&&(t=n);let i="";for(let s=e;s<t;++s)i+=Zs[r[s]];return i}function Qs(r,e,t){let n=r.slice(e,t),i="";for(let s=0;s<n.length-1;s+=2)i+=String.fromCharCode(n[s]+n[s+1]*256);return i}l.prototype.slice=function(e,t){let n=this.length;e=~~e,t=t===void 0?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);let i=this.subarray(e,t);return Object.setPrototypeOf(i,l.prototype),i};function I(r,e,t){if(r%1!==0||r<0)throw new RangeError("offset is not uint");if(r+e>t)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(e,t,n){e=e>>>0,t=t>>>0,n||I(e,t,this.length);let i=this[e],s=1,o=0;for(;++o<t&&(s*=256);)i+=this[e+o]*s;return i};l.prototype.readUintBE=l.prototype.readUIntBE=function(e,t,n){e=e>>>0,t=t>>>0,n||I(e,t,this.length);let i=this[e+--t],s=1;for(;t>0&&(s*=256);)i+=this[e+--t]*s;return i};l.prototype.readUint8=l.prototype.readUInt8=function(e,t){return e=e>>>0,t||I(e,1,this.length),this[e]};l.prototype.readUint16LE=l.prototype.readUInt16LE=function(e,t){return e=e>>>0,t||I(e,2,this.length),this[e]|this[e+1]<<8};l.prototype.readUint16BE=l.prototype.readUInt16BE=function(e,t){return e=e>>>0,t||I(e,2,this.length),this[e]<<8|this[e+1]};l.prototype.readUint32LE=l.prototype.readUInt32LE=function(e,t){return e=e>>>0,t||I(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};l.prototype.readUint32BE=l.prototype.readUInt32BE=function(e,t){return e=e>>>0,t||I(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};l.prototype.readBigUInt64LE=le(function(e){e=e>>>0,ke(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&pt(e,this.length-8);let i=t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24,s=this[++e]+this[++e]*2**8+this[++e]*2**16+n*2**24;return BigInt(i)+(BigInt(s)<<BigInt(32))});l.prototype.readBigUInt64BE=le(function(e){e=e>>>0,ke(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&pt(e,this.length-8);let i=t*2**24+this[++e]*2**16+this[++e]*2**8+this[++e],s=this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+n;return(BigInt(i)<<BigInt(32))+BigInt(s)});l.prototype.readIntLE=function(e,t,n){e=e>>>0,t=t>>>0,n||I(e,t,this.length);let i=this[e],s=1,o=0;for(;++o<t&&(s*=256);)i+=this[e+o]*s;return s*=128,i>=s&&(i-=Math.pow(2,8*t)),i};l.prototype.readIntBE=function(e,t,n){e=e>>>0,t=t>>>0,n||I(e,t,this.length);let i=t,s=1,o=this[e+--i];for(;i>0&&(s*=256);)o+=this[e+--i]*s;return s*=128,o>=s&&(o-=Math.pow(2,8*t)),o};l.prototype.readInt8=function(e,t){return e=e>>>0,t||I(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]};l.prototype.readInt16LE=function(e,t){e=e>>>0,t||I(e,2,this.length);let n=this[e]|this[e+1]<<8;return n&32768?n|4294901760:n};l.prototype.readInt16BE=function(e,t){e=e>>>0,t||I(e,2,this.length);let n=this[e+1]|this[e]<<8;return n&32768?n|4294901760:n};l.prototype.readInt32LE=function(e,t){return e=e>>>0,t||I(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};l.prototype.readInt32BE=function(e,t){return e=e>>>0,t||I(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};l.prototype.readBigInt64LE=le(function(e){e=e>>>0,ke(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&pt(e,this.length-8);let i=this[e+4]+this[e+5]*2**8+this[e+6]*2**16+(n<<24);return(BigInt(i)<<BigInt(32))+BigInt(t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24)});l.prototype.readBigInt64BE=le(function(e){e=e>>>0,ke(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&pt(e,this.length-8);let i=(t<<24)+this[++e]*2**16+this[++e]*2**8+this[++e];return(BigInt(i)<<BigInt(32))+BigInt(this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+n)});l.prototype.readFloatLE=function(e,t){return e=e>>>0,t||I(e,4,this.length),Ue.read(this,e,!0,23,4)};l.prototype.readFloatBE=function(e,t){return e=e>>>0,t||I(e,4,this.length),Ue.read(this,e,!1,23,4)};l.prototype.readDoubleLE=function(e,t){return e=e>>>0,t||I(e,8,this.length),Ue.read(this,e,!0,52,8)};l.prototype.readDoubleBE=function(e,t){return e=e>>>0,t||I(e,8,this.length),Ue.read(this,e,!1,52,8)};function C(r,e,t,n,i,s){if(!l.isBuffer(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw new RangeError('"value" argument is out of bounds');if(t+n>r.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(e,t,n,i){if(e=+e,t=t>>>0,n=n>>>0,!i){let a=Math.pow(2,8*n)-1;C(this,e,t,n,a,0)}let s=1,o=0;for(this[t]=e&255;++o<n&&(s*=256);)this[t+o]=e/s&255;return t+n};l.prototype.writeUintBE=l.prototype.writeUIntBE=function(e,t,n,i){if(e=+e,t=t>>>0,n=n>>>0,!i){let a=Math.pow(2,8*n)-1;C(this,e,t,n,a,0)}let s=n-1,o=1;for(this[t+s]=e&255;--s>=0&&(o*=256);)this[t+s]=e/o&255;return t+n};l.prototype.writeUint8=l.prototype.writeUInt8=function(e,t,n){return e=+e,t=t>>>0,n||C(this,e,t,1,255,0),this[t]=e&255,t+1};l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t=t>>>0,n||C(this,e,t,2,65535,0),this[t]=e&255,this[t+1]=e>>>8,t+2};l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t=t>>>0,n||C(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=e&255,t+2};l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t=t>>>0,n||C(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255,t+4};l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t=t>>>0,n||C(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};function ni(r,e,t,n,i){ui(e,n,i,r,t,7);let s=Number(e&BigInt(4294967295));r[t++]=s,s=s>>8,r[t++]=s,s=s>>8,r[t++]=s,s=s>>8,r[t++]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return r[t++]=o,o=o>>8,r[t++]=o,o=o>>8,r[t++]=o,o=o>>8,r[t++]=o,t}function ii(r,e,t,n,i){ui(e,n,i,r,t,7);let s=Number(e&BigInt(4294967295));r[t+7]=s,s=s>>8,r[t+6]=s,s=s>>8,r[t+5]=s,s=s>>8,r[t+4]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return r[t+3]=o,o=o>>8,r[t+2]=o,o=o>>8,r[t+1]=o,o=o>>8,r[t]=o,t+8}l.prototype.writeBigUInt64LE=le(function(e,t=0){return ni(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});l.prototype.writeBigUInt64BE=le(function(e,t=0){return ii(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});l.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t=t>>>0,!i){let u=Math.pow(2,8*n-1);C(this,e,t,n,u-1,-u)}let s=0,o=1,a=0;for(this[t]=e&255;++s<n&&(o*=256);)e<0&&a===0&&this[t+s-1]!==0&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n};l.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t=t>>>0,!i){let u=Math.pow(2,8*n-1);C(this,e,t,n,u-1,-u)}let s=n-1,o=1,a=0;for(this[t+s]=e&255;--s>=0&&(o*=256);)e<0&&a===0&&this[t+s+1]!==0&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n};l.prototype.writeInt8=function(e,t,n){return e=+e,t=t>>>0,n||C(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=e&255,t+1};l.prototype.writeInt16LE=function(e,t,n){return e=+e,t=t>>>0,n||C(this,e,t,2,32767,-32768),this[t]=e&255,this[t+1]=e>>>8,t+2};l.prototype.writeInt16BE=function(e,t,n){return e=+e,t=t>>>0,n||C(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=e&255,t+2};l.prototype.writeInt32LE=function(e,t,n){return e=+e,t=t>>>0,n||C(this,e,t,4,2147483647,-2147483648),this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4};l.prototype.writeInt32BE=function(e,t,n){return e=+e,t=t>>>0,n||C(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};l.prototype.writeBigInt64LE=le(function(e,t=0){return ni(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});l.prototype.writeBigInt64BE=le(function(e,t=0){return ii(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function si(r,e,t,n,i,s){if(t+n>r.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function oi(r,e,t,n,i){return e=+e,t=t>>>0,i||si(r,e,t,4,34028234663852886e22,-34028234663852886e22),Ue.write(r,e,t,n,23,4),t+4}l.prototype.writeFloatLE=function(e,t,n){return oi(this,e,t,!0,n)};l.prototype.writeFloatBE=function(e,t,n){return oi(this,e,t,!1,n)};function ai(r,e,t,n,i){return e=+e,t=t>>>0,i||si(r,e,t,8,17976931348623157e292,-17976931348623157e292),Ue.write(r,e,t,n,52,8),t+8}l.prototype.writeDoubleLE=function(e,t,n){return ai(this,e,t,!0,n)};l.prototype.writeDoubleBE=function(e,t,n){return ai(this,e,t,!1,n)};l.prototype.copy=function(e,t,n,i){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),!i&&i!==0&&(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);let s=i-n;return this===e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(t,n,i):Uint8Array.prototype.set.call(e,this.subarray(n,i),t),s};l.prototype.fill=function(e,t,n,i){if(typeof e=="string"){if(typeof t=="string"?(i=t,t=0,n=this.length):typeof n=="string"&&(i=n,n=this.length),i!==void 0&&typeof i!="string")throw new TypeError("encoding must be a string");if(typeof i=="string"&&!l.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(e.length===1){let o=e.charCodeAt(0);(i==="utf8"&&o<128||i==="latin1")&&(e=o)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t=t>>>0,n=n===void 0?this.length:n>>>0,e||(e=0);let s;if(typeof e=="number")for(s=t;s<n;++s)this[s]=e;else{let o=l.isBuffer(e)?e:l.from(e,i),a=o.length;if(a===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<n-t;++s)this[s+t]=o[s%a]}return this};var Ce={};function Cr(r,e,t){Ce[r]=class extends t{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${r}]`,this.stack,delete this.name}get code(){return r}set code(i){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:i,writable:!0})}toString(){return`${this.name} [${r}]: ${this.message}`}}}Cr("ERR_BUFFER_OUT_OF_BOUNDS",function(r){return r?`${r} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError);Cr("ERR_INVALID_ARG_TYPE",function(r,e){return`The "${r}" argument must be of type number. Received type ${typeof e}`},TypeError);Cr("ERR_OUT_OF_RANGE",function(r,e,t){let n=`The value of "${r}" is out of range.`,i=t;return Number.isInteger(t)&&Math.abs(t)>2**32?i=Xn(String(t)):typeof t=="bigint"&&(i=String(t),(t>BigInt(2)**BigInt(32)||t<-(BigInt(2)**BigInt(32)))&&(i=Xn(i)),i+="n"),n+=` It must be ${e}. Received ${i}`,n},RangeError);function Xn(r){let e="",t=r.length,n=r[0]==="-"?1:0;for(;t>=n+4;t-=3)e=`_${r.slice(t-3,t)}${e}`;return`${r.slice(0,t)}${e}`}function Vs(r,e,t){ke(e,"offset"),(r[e]===void 0||r[e+t]===void 0)&&pt(e,r.length-(t+1))}function ui(r,e,t,n,i,s){if(r>t||r<e){let o=typeof e=="bigint"?"n":"",a;throw s>3?e===0||e===BigInt(0)?a=`>= 0${o} and < 2${o} ** ${(s+1)*8}${o}`:a=`>= -(2${o} ** ${(s+1)*8-1}${o}) and < 2 ** ${(s+1)*8-1}${o}`:a=`>= ${e}${o} and <= ${t}${o}`,new Ce.ERR_OUT_OF_RANGE("value",a,r)}Vs(n,i,s)}function ke(r,e){if(typeof r!="number")throw new Ce.ERR_INVALID_ARG_TYPE(e,"number",r)}function pt(r,e,t){throw Math.floor(r)!==r?(ke(r,t),new Ce.ERR_OUT_OF_RANGE(t||"offset","an integer",r)):e<0?new Ce.ERR_BUFFER_OUT_OF_BOUNDS:new Ce.ERR_OUT_OF_RANGE(t||"offset",`>= ${t?1:0} and <= ${e}`,r)}var Ys=/[^+/0-9A-Za-z-_]/g;function Ks(r){if(r=r.split("=")[0],r=r.trim().replace(Ys,""),r.length<2)return"";for(;r.length%4!==0;)r=r+"=";return r}function Rr(r,e){e=e||1/0;let t,n=r.length,i=null,s=[];for(let o=0;o<n;++o){if(t=r.charCodeAt(o),t>55295&&t<57344){if(!i){if(t>56319){(e-=3)>-1&&s.push(239,191,189);continue}else if(o+1===n){(e-=3)>-1&&s.push(239,191,189);continue}i=t;continue}if(t<56320){(e-=3)>-1&&s.push(239,191,189),i=t;continue}t=(i-55296<<10|t-56320)+65536}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,t<128){if((e-=1)<0)break;s.push(t)}else if(t<2048){if((e-=2)<0)break;s.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;s.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;s.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return s}function Xs(r){let e=[];for(let t=0;t<r.length;++t)e.push(r.charCodeAt(t)&255);return e}function Js(r,e){let t,n,i,s=[];for(let o=0;o<r.length&&!((e-=2)<0);++o)t=r.charCodeAt(o),n=t>>8,i=t%256,s.push(i),s.push(n);return s}function ci(r){return Dr.toByteArray(Ks(r))}function Ct(r,e,t,n){let i;for(i=0;i<n&&!(i+t>=e.length||i>=r.length);++i)e[i+t]=r[i];return i}function X(r,e){return r instanceof e||r!=null&&r.constructor!=null&&r.constructor.name!=null&&r.constructor.name===e.name}function Ur(r){return r!==r}var Zs=function(){let r="0123456789abcdef",e=new Array(256);for(let t=0;t<16;++t){let n=t*16;for(let i=0;i<16;++i)e[n+i]=r[t]+r[i]}return e}();function le(r){return typeof BigInt>"u"?eo:r}function eo(){throw new Error("BigInt not supported")}});var Ta={};de(Ta,{IdbFs:()=>Ne,MemoryFS:()=>Re,Mutex:()=>ne,PGlite:()=>en,formatQuery:()=>Gn,messages:()=>Ir,parse:()=>Vr,protocol:()=>Zr,types:()=>Qr,uuid:()=>jn});module.exports=Ni(Ta);m();m();m();var Pa=new Error("timeout while waiting for mutex to become available"),Aa=new Error("mutex already locked"),Mi=new Error("request for lock canceled"),_i=function(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(f){try{c(n.next(f))}catch(h){o(h)}}function u(f){try{c(n.throw(f))}catch(h){o(h)}}function c(f){f.done?s(f.value):i(f.value).then(a,u)}c((n=n.apply(r,e||[])).next())})},Zt=class{constructor(e,t=Mi){this._value=e,this._cancelError=t,this._weightedQueues=[],this._weightedWaiters=[]}acquire(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((t,n)=>{this._weightedQueues[e-1]||(this._weightedQueues[e-1]=[]),this._weightedQueues[e-1].push({resolve:t,reject:n}),this._dispatch()})}runExclusive(e,t=1){return _i(this,void 0,void 0,function*(){let[n,i]=yield this.acquire(t);try{return yield e(n)}finally{i()}})}waitForUnlock(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise(t=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),this._weightedWaiters[e-1].push(t),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatch()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatch()}cancel(){this._weightedQueues.forEach(e=>e.forEach(t=>t.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var e;for(let t=this._value;t>0;t--){let n=(e=this._weightedQueues[t-1])===null||e===void 0?void 0:e.shift();if(!n)continue;let i=this._value,s=t;this._value-=t,t=this._value+1,n.resolve([i,this._newReleaser(s)])}this._drainUnlockWaiters()}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){for(let e=this._value;e>0;e--)this._weightedWaiters[e-1]&&(this._weightedWaiters[e-1].forEach(t=>t()),this._weightedWaiters[e-1]=[])}},Ci=function(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(f){try{c(n.next(f))}catch(h){o(h)}}function u(f){try{c(n.throw(f))}catch(h){o(h)}}function c(f){f.done?s(f.value):i(f.value).then(a,u)}c((n=n.apply(r,e||[])).next())})},ne=class{constructor(e){this._semaphore=new Zt(1,e)}acquire(){return Ci(this,void 0,void 0,function*(){let[,e]=yield this._semaphore.acquire();return e})}runExclusive(e){return this._semaphore.runExclusive(()=>e())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};m();var un=N(require("./postgres.cjs").default,1),cn=un.default;me();m();var yr=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string";async function zn(){let r=new URL("./postgres.wasm",w),e=new URL("./postgres.data",w),t=n=>n.pathname;return yr&&(t=(await import("url")).fileURLToPath),n=>{let i=null;switch(n){case"postgres.data":i=e;break;case"postgres.wasm":i=r;break;default:console.error("makeLocateFile",n)}return i?.protocol==="file:"?t(i):i?.toString()??""}}var jn=()=>{if(globalThis.crypto?.randomUUID)return globalThis.crypto.randomUUID();let r=new Uint8Array(16);if(globalThis.crypto?.getRandomValues)globalThis.crypto.getRandomValues(r);else for(let t=0;t<r.length;t++)r[t]=Math.floor(Math.random()*256);r[6]=r[6]&15|64,r[8]=r[8]&63|128;let e=[];return r.forEach(t=>{e.push(t.toString(16).padStart(2,"0"))}),e.slice(0,4).join("")+"-"+e.slice(4,6).join("")+"-"+e.slice(6,8).join("")+"-"+e.slice(8,10).join("")+"-"+e.slice(10).join("")};async function Gn(r,e,t){if(!t||t.length===0)return e;let n=e.replace(/\$([0-9]+)/g,(s,o)=>"%"+o+"L");return(await r.query(`SELECT format($1, ${t.map((s,o)=>`$${o+2}`).join(", ")}) as query`,[n,...t],{setAllTypes:!0})).rows[0].query}m();var Hn={part:"part",container:"container"};function Rt(r,e,...t){let n=r.length-1,i=t.length-1;if(i!==-1){if(i===0){r[n]=r[n]+t[0]+e;return}r[n]=r[n]+t[0],r.push(...t.slice(1,i)),r.push(t[i]+e)}}function Ss(r,...e){let t=[r[0]];t.raw=[r.raw[0]];let n=[];for(let i=0;i<e.length;i++){let s=e[i],o=i+1;if(s._templateType===Hn.part){Rt(t,r[o],s.str),Rt(t.raw,r.raw[o],s.str);continue}if(s._templateType===Hn.container){Rt(t,r[o],...s.strings),Rt(t.raw,r.raw[o],...s.strings.raw),n.push(...s.values);continue}t.push(r[o]),t.raw.push(r.raw[o]),n.push(s)}return{_templateType:"container",strings:t,values:n}}function gr(r,...e){let{strings:t,values:n}=Ss(r,...e);return{query:[t[0],...n.flatMap((i,s)=>[`$${s+1}`,t[s+1]])].join(""),params:n}}var Vr={};de(Vr,{parseResults:()=>$t});m();var Ir={};de(Ir,{AuthenticationMD5Password:()=>ut,BackendKeyDataMessage:()=>ct,CommandCompleteMessage:()=>Y,CopyDataMessage:()=>nt,CopyResponse:()=>it,DataRowMessage:()=>ce,DatabaseError:()=>V,Field:()=>st,NoticeMessage:()=>be,NotificationResponseMessage:()=>we,ParameterDescriptionMessage:()=>ot,ParameterStatusMessage:()=>at,ReadyForQueryMessage:()=>lt,RowDescriptionMessage:()=>ue,bindComplete:()=>br,closeComplete:()=>xr,copyDone:()=>Br,emptyQuery:()=>Tr,noData:()=>Er,parseComplete:()=>wr,portalSuspended:()=>Sr,replicationStart:()=>Fr});m();var wr={name:"parseComplete",length:5},br={name:"bindComplete",length:5},xr={name:"closeComplete",length:5},Er={name:"noData",length:5},Sr={name:"portalSuspended",length:5},Fr={name:"replicationStart",length:4},Tr={name:"emptyQuery",length:4},Br={name:"copyDone",length:4},V=class extends Error{constructor(t,n,i){super(t);this.length=n;this.name=i}},nt=class{constructor(e,t){this.length=e;this.chunk=t;this.name="copyData"}},it=class{constructor(e,t,n,i){this.length=e;this.name=t;this.binary=n;this.columnTypes=new Array(i)}},st=class{constructor(e,t,n,i,s,o,a){this.name=e;this.tableID=t;this.columnID=n;this.dataTypeID=i;this.dataTypeSize=s;this.dataTypeModifier=o;this.format=a}},ue=class{constructor(e,t){this.length=e;this.fieldCount=t;this.name="rowDescription";this.fields=new Array(this.fieldCount)}},ot=class{constructor(e,t){this.length=e;this.parameterCount=t;this.name="parameterDescription";this.dataTypeIDs=new Array(this.parameterCount)}},at=class{constructor(e,t,n){this.length=e;this.parameterName=t;this.parameterValue=n;this.name="parameterStatus"}},ut=class{constructor(e,t){this.length=e;this.salt=t;this.name="authenticationMD5Password"}},ct=class{constructor(e,t,n){this.length=e;this.processID=t;this.secretKey=n;this.name="backendKeyData"}},we=class{constructor(e,t,n,i){this.length=e;this.processId=t;this.channel=n;this.payload=i;this.name="notification"}},lt=class{constructor(e,t){this.length=e;this.status=t;this.name="readyForQuery"}},Y=class{constructor(e,t){this.length=e;this.text=t;this.name="commandComplete"}},ce=class{constructor(e,t){this.length=e;this.fields=t;this.name="dataRow";this.fieldCount=t.length}},be=class{constructor(e,t){this.length=e;this.message=t;this.name="notice"}};var Qr={};de(Qr,{ABSTIME:()=>ho,ACLITEM:()=>So,BIT:()=>Po,BOOL:()=>kr,BPCHAR:()=>Fo,BYTEA:()=>vt,CHAR:()=>fi,CID:()=>oo,CIDR:()=>fo,CIRCLE:()=>go,DATE:()=>Hr,FLOAT4:()=>jr,FLOAT8:()=>jt,GTSVECTOR:()=>Ho,INET:()=>Eo,INT2:()=>vr,INT4:()=>Lr,INT8:()=>ft,INTERVAL:()=>Bo,JSON:()=>zt,JSONB:()=>Wr,MACADDR:()=>xo,MACADDR8:()=>wo,MONEY:()=>bo,NUMERIC:()=>Do,OID:()=>zr,PATH:()=>lo,PG_DEPENDENCIES:()=>zo,PG_LSN:()=>vo,PG_NDISTINCT:()=>Lo,PG_NODE_TREE:()=>uo,POLYGON:()=>po,REFCURSOR:()=>Oo,REGCLASS:()=>_o,REGCONFIG:()=>qo,REGDICTIONARY:()=>$o,REGNAMESPACE:()=>Wo,REGOPER:()=>Ro,REGOPERATOR:()=>Mo,REGPROC:()=>no,REGPROCEDURE:()=>No,REGROLE:()=>Qo,REGTYPE:()=>Co,RELTIME:()=>mo,SMGR:()=>co,TEXT:()=>Lt,TID:()=>io,TIME:()=>To,TIMESTAMP:()=>qr,TIMESTAMPTZ:()=>$r,TIMETZ:()=>Io,TINTERVAL:()=>yo,TSQUERY:()=>Go,TSVECTOR:()=>jo,TXID_SNAPSHOT:()=>ko,UUID:()=>Uo,VARBIT:()=>Ao,VARCHAR:()=>Gr,XID:()=>so,XML:()=>ao,arrayTypes:()=>Ut,parseArray:()=>wi,parseType:()=>qt,parsers:()=>hi,serializeType:()=>Ht,serializerFor:()=>yi,serializerInstanceof:()=>mi,serializers:()=>kt,types:()=>di});m();m();var pi=N(li(),1),J;globalThis.Buffer?J=globalThis.Buffer:J=pi.Buffer;var to=globalThis.JSON.parse,ro=globalThis.JSON.stringify,kr=16,vt=17,fi=18,ft=20,vr=21,Lr=23,no=24,Lt=25,zr=26,io=27,so=28,oo=29,zt=114,ao=142,uo=194,co=210,lo=602,po=604,fo=650,jr=700,jt=701,ho=702,mo=703,yo=704,go=718,wo=774,bo=790,xo=829,Eo=869,So=1033,Fo=1042,Gr=1043,Hr=1082,To=1083,qr=1114,$r=1184,Bo=1186,Io=1266,Po=1560,Ao=1562,Do=1700,Oo=1790,No=2202,Ro=2203,Mo=2204,_o=2205,Co=2206,Uo=2950,ko=2970,vo=3220,Lo=3361,zo=3402,jo=3614,Go=3615,Ho=3642,qo=3734,$o=3769,Wr=3802,Wo=4089,Qo=4096,Ut={1001:vt,1002:fi,1016:ft,1005:vr,1007:Lr,1009:Lt,1028:zr,199:zt,1021:jr,1022:jt,1015:Gr,3807:Wr,1182:Hr,1115:qr,1116:$r},di={string:{to:0,from:[Lt,Gr],serialize:r=>r,parse:r=>r,forceTo:Lt},number:{to:0,from:[vr,Lr,zr,jr,jt],serialize:r=>r.toString(),parse:r=>+r,forceTo:r=>Number.isInteger(r)?ft:jt},bigint:{to:ft,from:[ft],js:[BigInt],serialize:r=>r.toString(),parse:r=>{let e=BigInt(r);return e<Number.MIN_SAFE_INTEGER||e>Number.MAX_SAFE_INTEGER?e:Number(e)}},json:{to:zt,from:[zt,Wr],serialize:r=>ro(r),parse:r=>to(r)},boolean:{to:kr,from:[kr],serialize:r=>r===!0?"t":"f",parse:r=>r==="t"},date:{to:1184,from:[Hr,qr,$r],js:[Date],serialize:r=>(r instanceof Date?r:new Date(r)).toISOString(),parse:r=>new Date(r)},bytea:{to:vt,from:[vt],js:[Uint8Array,J],serialize:r=>"\\x"+J.from(r).toString("hex"),parse:r=>new Uint8Array(J.from(r.slice(2),"hex"))},array:{to:0,from:Object.keys(Ut).map(r=>+r),serialize:r=>gi(r),parse:(r,e)=>{let t;return e&&e in Ut&&(t=hi[Ut[e]]),wi(r,t)}}},Gt=Yo(di),hi=Gt.parsers,kt=Gt.serializers,mi=Gt.serializerInstanceof;function yi(r){if(Array.isArray(r))return kt.array;let e=kt[typeof r];if(e)return e;for(let[t,n]of mi)if(r instanceof t)return n;return kt.json}function Ht(r,e=!1){return r==null?[null,0]:yi(r)(r,e)}function Vo(r){return'"'+r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function gi(r){let e="{";for(let t=0;t<r.length;t++)if(t>0&&(e=e+","),r[t]===null||typeof r[t]>"u")e=e+"NULL";else if(Array.isArray(r[t]))e=e+gi(r[t]);else if(ArrayBuffer.isView(r[t])){let n=r[t];if(!(n instanceof J)){let i=J.from(n.buffer,n.byteOffset,n.byteLength);i.length===n.byteLength?n=i:n=i.slice(n.byteOffset,n.byteOffset+n.byteLength)}e+="\\\\x"+n.toString("hex")}else e+=Vo(Ht(r[t])[0]);return e=e+"}",e}function wi(r,e){let t=0,n=null,i="",s=!1,o=0,a;function u(c){let f=[];for(;t<c.length;t++){if(n=c[t],s)n==="\\"?i+=c[++t]:n==='"'?(f.push(e?e(i):i),i="",s=c[t+1]==='"',o=t+2):i+=n;else if(n==='"')s=!0;else if(n==="{")o=++t,f.push(u(c));else if(n==="}"){s=!1,o<t&&f.push(e?e(c.slice(o,t)):c.slice(o,t)),o=t+1;break}else n===","&&a!=="}"&&a!=='"'&&(f.push(e?e(c.slice(o,t)):c.slice(o,t)),o=t+1);a=n}return o<t&&f.push(e?e(c.slice(o,t+1)):c.slice(o,t+1)),f}return u(r)[0]}function qt(r,e,t){if(r===null)return null;let n=t?.[e]??Gt.parsers[e];return n?n(r,e):r}function Yo(r){return Object.keys(r).reduce(({parsers:e,serializers:t,serializerInstanceof:n},i)=>{let{to:s,from:o,serialize:a,parse:u=null,forceTo:c}=r[i],f=(h,T=!1)=>[a(h),T&&c?typeof c=="function"?c(h):c:s];return t[s]=f,t[i]=f,r[i].js&&r[i].js.forEach(h=>n.push([h,f])),u&&(Array.isArray(o)?o.forEach(h=>e[h]=u):e[o]=u,e[i]=u),{parsers:e,serializers:t,serializerInstanceof:n}},{parsers:{},serializers:{},serializerInstanceof:[]})}function $t(r,e,t){let n=[],i={rows:[],fields:[]},s=0,o=r.filter(a=>a instanceof ue||a instanceof ce||a instanceof Y);return o.forEach((a,u)=>{a instanceof ue?i.fields=a.fields.map(c=>({name:c.name,dataTypeID:c.dataTypeID})):a instanceof ce&&i?e?.rowMode==="array"?i.rows.push(a.fields.map((c,f)=>qt(c,i.fields[f].dataTypeID,e?.parsers))):i.rows.push(Object.fromEntries(a.fields.map((c,f)=>[i.fields[f].name,qt(c,i.fields[f].dataTypeID,e?.parsers)]))):a instanceof Y&&(s+=Ko(a),u===o.length-1?n.push({...i,affectedRows:s,...t?{blob:t}:{}}):n.push(i),i={rows:[],fields:[]})}),n.length===0&&n.push({rows:[],fields:[]}),n}function Ko(r){let e=r.text.split(" ");switch(e[0]){case"INSERT":return parseInt(e[2],10);case"UPDATE":case"DELETE":return parseInt(e[1],10);default:return 0}}m();var bi=N(ar(),1);async function Yr(r){if(yr){let e=await import("fs"),t=await import("zlib"),{Writable:n}=await import("stream"),{pipeline:i}=await import("stream/promises");if(!e.existsSync(r))throw new Error(`Extension bundle not found: ${r}`);let s=t.createGunzip(),o=[];return await i(e.createReadStream(r),s,new n({write(a,u,c){o.push(a),c()}})),new Blob(o)}else{let e=await fetch(r.toString());if(!e.ok||!e.body)return null;if(e.headers.get("Content-Encoding")==="gzip")return e.blob();{let t=new DecompressionStream("gzip");return new Response(e.body.pipeThrough(t)).blob()}}}async function xi(r,e){for(let t in r.pg_extensions){let n;try{n=await r.pg_extensions[t]}catch(i){console.error("Failed to fetch extension:",t,i);continue}if(n){let i=new Uint8Array(await n.arrayBuffer());Xo(r,t,i,e)}else console.error("Could not get binary data for extension:",t)}}function Xo(r,e,t,n){bi.default.untar(t).forEach(s=>{if(!s.name.startsWith(".")){let o=r.WASM_PREFIX+"/"+s.name;if(s.name.endsWith(".so")){let a=(...c)=>{n("pgfs:ext OK",o,c)},u=(...c)=>{n("pgfs:ext FAIL",o,c)};r.FS.createPreloadedFile(Jo(o),s.name.split("/").pop().slice(0,-3),s.data,!0,!0,a,u,!1)}else r.FS.writeFile(o,s.data)}})}function Jo(r){let e=r.lastIndexOf("/");return e>0?r.slice(0,e):r}Oe();me();var Zr={};de(Zr,{DatabaseError:()=>V,parse:()=>Fa,serialize:()=>z});m();m();var v=require("buffer");m();var Le=require("buffer"),ze=class{constructor(e=256){this.size=e;this.offset=5;this.headerPosition=0;this.buffer=Le.Buffer.allocUnsafe(e)}ensure(e){var t=this.buffer.length-this.offset;if(t<e){var n=this.buffer,i=n.length+(n.length>>1)+e;this.buffer=Le.Buffer.allocUnsafe(i),n.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{var t=Le.Buffer.byteLength(e);this.ensure(t+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=t}return this.buffer[this.offset++]=0,this}addString(e=""){var t=Le.Buffer.byteLength(e);return this.ensure(t),this.buffer.write(e,this.offset),this.offset+=t,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let t=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(t,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){var t=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=Le.Buffer.allocUnsafe(this.size),t}};var E=new ze,Zo=r=>{E.addInt16(3).addInt16(0);for(let n of Object.keys(r))E.addCString(n).addCString(r[n]);E.addCString("client_encoding").addCString("UTF8");var e=E.addCString("").flush(),t=e.length+4;return new ze().addInt32(t).add(e).flush()},ea=()=>{let r=v.Buffer.allocUnsafe(8);return r.writeInt32BE(8,0),r.writeInt32BE(80877103,4),r},ta=r=>E.addCString(r).flush(112),ra=function(r,e){return E.addCString(r).addInt32(v.Buffer.byteLength(e)).addString(e),E.flush(112)},na=function(r){return E.addString(r).flush(112)},ia=r=>E.addCString(r).flush(81),Ei=[],sa=r=>{let e=r.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let t=r.types||Ei;for(var n=t.length,i=E.addCString(e).addCString(r.text).addInt16(n),s=0;s<n;s++)i.addInt32(t[s]);return E.flush(80)},je=new ze;var oa=function(r,e){for(let t=0;t<r.length;t++){let n=e?e(r[t],t):r[t];n==null?(E.addInt16(0),je.addInt32(-1)):n instanceof v.Buffer?(E.addInt16(1),je.addInt32(n.length),je.add(n)):(E.addInt16(0),je.addInt32(v.Buffer.byteLength(n)),je.addString(n))}},aa=(r={})=>{let e=r.portal||"",t=r.statement||"",n=r.binary||!1,i=r.values||Ei,s=i.length;return E.addCString(e).addCString(t),E.addInt16(s),oa(i,r.valueMapper),E.addInt16(s),E.add(je.flush()),E.addInt16(n?1:0),E.flush(66)},ua=v.Buffer.from([69,0,0,0,9,0,0,0,0,0]),ca=r=>{if(!r||!r.portal&&!r.rows)return ua;let e=r.portal||"",t=r.rows||0,n=v.Buffer.byteLength(e),i=4+n+1+4,s=v.Buffer.allocUnsafe(1+i);return s[0]=69,s.writeInt32BE(i,1),s.write(e,5,"utf-8"),s[n+5]=0,s.writeUInt32BE(t,s.length-4),s},la=(r,e)=>{let t=v.Buffer.allocUnsafe(16);return t.writeInt32BE(16,0),t.writeInt16BE(1234,4),t.writeInt16BE(5678,6),t.writeInt32BE(r,8),t.writeInt32BE(e,12),t},Kr=(r,e)=>{let n=4+v.Buffer.byteLength(e)+1,i=v.Buffer.allocUnsafe(1+n);return i[0]=r,i.writeInt32BE(n,1),i.write(e,5,"utf-8"),i[n]=0,i},pa=E.addCString("P").flush(68),fa=E.addCString("S").flush(68),da=r=>r.name?Kr(68,`${r.type}${r.name||""}`):r.type==="P"?pa:fa,ha=r=>{let e=`${r.type}${r.name||""}`;return Kr(67,e)},ma=r=>E.add(r).flush(100),ya=r=>Kr(102,r),Wt=r=>v.Buffer.from([r,0,0,0,4]),ga=Wt(72),wa=Wt(83),ba=Wt(88),xa=Wt(99),z={startup:Zo,password:ta,requestSsl:ea,sendSASLInitialResponseMessage:ra,sendSCRAMClientFinalMessage:na,query:ia,parse:sa,bind:aa,execute:ca,describe:da,close:ha,flush:()=>ga,sync:()=>wa,end:()=>ba,copyData:ma,copyDone:()=>xa,copyFail:ya,cancel:la};m();var Jr=require("buffer");m();var Si=require("buffer"),Ea=Si.Buffer.allocUnsafe(0),Qt=class{constructor(e=0){this.offset=e;this.buffer=Ea;this.encoding="utf-8"}setBuffer(e,t){this.offset=e,this.buffer=t}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}string(e){let t=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,t}cstring(){let e=this.offset,t=e;for(;this.buffer[t++]!==0;);return this.offset=t,this.buffer.toString(this.encoding,e,t-1)}bytes(e){let t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}};var Xr=1,Sa=4,Fi=Xr+Sa,Ti=Jr.Buffer.allocUnsafe(0);var Se=class{constructor(e){this.buffer=Ti;this.bufferLength=0;this.bufferOffset=0;this.reader=new Qt;if(e?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=e?.mode||"text"}parse(e,t){this.mergeBuffer(e);let n=this.bufferOffset+this.bufferLength,i=this.bufferOffset;for(;i+Fi<=n;){let s=this.buffer[i],o=this.buffer.readUInt32BE(i+Xr),a=Xr+o;if(a+i<=n){let u=this.handlePacket(i+Fi,s,o,this.buffer);t(u),i+=a}else break}i===n?(this.buffer=Ti,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=n-i,this.bufferOffset=i)}mergeBuffer(e){if(this.bufferLength>0){let t=this.bufferLength+e.byteLength;if(t+this.bufferOffset>this.buffer.byteLength){let i;if(t<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)i=this.buffer;else{let s=this.buffer.byteLength*2;for(;t>=s;)s*=2;i=Jr.Buffer.allocUnsafe(s)}this.buffer.copy(i,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=i,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=t}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,t,n,i){switch(t){case 50:return br;case 49:return wr;case 51:return xr;case 110:return Er;case 115:return Sr;case 99:return Br;case 87:return Fr;case 73:return Tr;case 68:return this.parseDataRowMessage(e,n,i);case 67:return this.parseCommandCompleteMessage(e,n,i);case 90:return this.parseReadyForQueryMessage(e,n,i);case 65:return this.parseNotificationMessage(e,n,i);case 82:return this.parseAuthenticationResponse(e,n,i);case 83:return this.parseParameterStatusMessage(e,n,i);case 75:return this.parseBackendKeyData(e,n,i);case 69:return this.parseErrorMessage(e,n,i,"error");case 78:return this.parseErrorMessage(e,n,i,"notice");case 84:return this.parseRowDescriptionMessage(e,n,i);case 116:return this.parseParameterDescriptionMessage(e,n,i);case 71:return this.parseCopyInMessage(e,n,i);case 72:return this.parseCopyOutMessage(e,n,i);case 100:return this.parseCopyData(e,n,i);default:return new V("received invalid response: "+t.toString(16),n,"error")}}parseReadyForQueryMessage(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.string(1);return new lt(t,i)}parseCommandCompleteMessage(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.cstring();return new Y(t,i)}parseCopyData(e,t,n){let i=n.slice(e,e+(t-4));return new nt(t,i)}parseCopyInMessage(e,t,n){return this.parseCopyMessage(e,t,n,"copyInResponse")}parseCopyOutMessage(e,t,n){return this.parseCopyMessage(e,t,n,"copyOutResponse")}parseCopyMessage(e,t,n,i){this.reader.setBuffer(e,n);let s=this.reader.byte()!==0,o=this.reader.int16(),a=new it(t,i,s,o);for(let u=0;u<o;u++)a.columnTypes[u]=this.reader.int16();return a}parseNotificationMessage(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.int32(),s=this.reader.cstring(),o=this.reader.cstring();return new we(t,i,s,o)}parseRowDescriptionMessage(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.int16(),s=new ue(t,i);for(let o=0;o<i;o++)s.fields[o]=this.parseField();return s}parseField(){let e=this.reader.cstring(),t=this.reader.int32(),n=this.reader.int16(),i=this.reader.int32(),s=this.reader.int16(),o=this.reader.int32(),a=this.reader.int16()===0?"text":"binary";return new st(e,t,n,i,s,o,a)}parseParameterDescriptionMessage(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.int16(),s=new ot(t,i);for(let o=0;o<i;o++)s.dataTypeIDs[o]=this.reader.int32();return s}parseDataRowMessage(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.int16(),s=new Array(i);for(let o=0;o<i;o++){let a=this.reader.int32();s[o]=a===-1?null:this.reader.string(a)}return new ce(t,s)}parseParameterStatusMessage(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.cstring(),s=this.reader.cstring();return new at(t,i,s)}parseBackendKeyData(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.int32(),s=this.reader.int32();return new ct(t,i,s)}parseAuthenticationResponse(e,t,n){this.reader.setBuffer(e,n);let i=this.reader.int32(),s={name:"authenticationOk",length:t};switch(i){case 0:break;case 3:s.length===8&&(s.name="authenticationCleartextPassword");break;case 5:if(s.length===12){s.name="authenticationMD5Password";let a=this.reader.bytes(4);return new ut(t,a)}break;case 10:s.name="authenticationSASL",s.mechanisms=[];let o;do o=this.reader.cstring(),o&&s.mechanisms.push(o);while(o);break;case 11:s.name="authenticationSASLContinue",s.data=this.reader.string(t-8);break;case 12:s.name="authenticationSASLFinal",s.data=this.reader.string(t-8);break;default:throw new Error("Unknown authenticationOk message type "+i)}return s}parseErrorMessage(e,t,n,i){this.reader.setBuffer(e,n);let s={},o=this.reader.string(1);for(;o!=="\0";)s[o]=this.reader.cstring(),o=this.reader.string(1);let a=s.M,u=i==="notice"?new be(t,a):new V(a,t,i);return u.severity=s.S,u.code=s.C,u.detail=s.D,u.hint=s.H,u.position=s.P,u.internalPosition=s.p,u.internalQuery=s.q,u.where=s.W,u.schema=s.s,u.table=s.t,u.column=s.c,u.dataType=s.d,u.constraint=s.n,u.file=s.F,u.line=s.L,u.routine=s.R,u}};function Fa(r,e){let t=new Se;return r.on("data",n=>t.parse(n,e)),new Promise(n=>r.on("end",()=>n()))}var Ge,Te,Be,Ie,He,mt,qe,Yt,$e,yt,gt,wt,Pe,j,G,Ae,g,Bi,Vt,pe,tn,rn,dt,fe,ht,Fe,nn=class nn{constructor(e={},t={}){b(this,g);b(this,Ge,!1);b(this,Te,!1);b(this,Be,!1);b(this,Ie,!1);b(this,He,!1);b(this,mt,new ne);b(this,qe,new ne);b(this,Yt,new ne);b(this,$e,!1);this.debug=0;b(this,yt);b(this,gt,[]);b(this,wt,new Se);b(this,Pe);b(this,j);b(this,G,new Map);b(this,Ae,new Set);typeof e=="string"?t={dataDir:e,...t}:t=e,this.dataDir=t.dataDir,t?.debug!==void 0&&(this.debug=t.debug),t?.relaxedDurability!==void 0&&x(this,He,t.relaxedDurability),x(this,yt,t.extensions??{}),this.waitReady=d(this,g,Bi).call(this,t??{})}static async create(e){let t=new nn(e);return await t.waitReady,t}get Module(){return this.mod}get ready(){return p(this,Ge)&&!p(this,Te)&&!p(this,Be)}get closed(){return p(this,Be)}async close(){await d(this,g,dt).call(this),x(this,Te,!0);for(let e of p(this,gt))await e();try{await this.execProtocol(z.end())}catch(e){let t=e;if(!(t.name==="ExitStatus"&&t.status===0))throw e}await this.fs.close(this.mod.FS),x(this,Be,!0),x(this,Te,!1)}async[Symbol.asyncDispose](){await this.close()}async query(e,t,n){return await d(this,g,dt).call(this),await p(this,qe).runExclusive(async()=>await d(this,g,Vt).call(this,e,t,n))}async sql(e,...t){let{query:n,params:i}=gr(e,...t);return await this.query(n,i)}async exec(e,t){return await d(this,g,dt).call(this),await p(this,qe).runExclusive(async()=>await d(this,g,pe).call(this,e,t))}async transaction(e){return await d(this,g,dt).call(this),await p(this,qe).runExclusive(async()=>{await d(this,g,pe).call(this,"BEGIN");let t=!1,n=()=>{if(t)throw new Error("Transaction is closed")};try{let s=await e({query:async(o,a,u)=>(n(),await d(this,g,Vt).call(this,o,a,u)),sql:async(o,...a)=>{let{query:u,params:c}=gr(o,...a);return await d(this,g,Vt).call(this,u,c)},exec:async(o,a)=>(n(),await d(this,g,pe).call(this,o,a)),rollback:async()=>{n(),await d(this,g,pe).call(this,"ROLLBACK"),t=!0},get closed(){return t}});return t||(t=!0,await d(this,g,pe).call(this,"COMMIT")),s}catch(i){throw t||await d(this,g,pe).call(this,"ROLLBACK"),i}})}async execProtocolRaw(e,{syncToFs:t=!0}={}){let n=e.length,i=this.mod;i._interactive_write(n),i.HEAPU8.set(e,1),i._interactive_one();let s=n+2,o=s+i._interactive_read(),a=i.HEAPU8.subarray(s,o);return t&&await d(this,g,ht).call(this),a}async execProtocol(e,{syncToFs:t=!0,onNotice:n}={}){let i=await this.execProtocolRaw(e,{syncToFs:t}),s=[];return p(this,wt).parse(J.from(i),o=>{if(o instanceof V)throw x(this,wt,new Se),o;if(o instanceof be)this.debug>0&&console.warn(o),n&&n(o);else if(o instanceof Y)switch(o.text){case"BEGIN":x(this,Ie,!0);break;case"COMMIT":case"ROLLBACK":x(this,Ie,!1);break}else if(o instanceof we){let a=p(this,G).get(o.channel);a&&a.forEach(u=>{queueMicrotask(()=>u(o.payload))}),p(this,Ae).forEach(u=>{queueMicrotask(()=>u(o.channel,o.payload))})}s.push([o,i])}),s}async listen(e,t){return p(this,G).has(e)||p(this,G).set(e,new Set),p(this,G).get(e).add(t),await this.exec(`LISTEN ${e}`),async()=>{await this.unlisten(e,t)}}async unlisten(e,t){t?(p(this,G).get(e)?.delete(t),p(this,G).get(e)?.size===0&&(await this.exec(`UNLISTEN ${e}`),p(this,G).delete(e))):(await this.exec(`UNLISTEN ${e}`),p(this,G).delete(e))}onNotification(e){return p(this,Ae).add(e),()=>{p(this,Ae).delete(e)}}offNotification(e){p(this,Ae).delete(e)}async dumpDataDir(e){let t=this.dataDir?.split("/").pop()??"pgdata";return this.fs.dumpTar(this.mod.FS,t,e)}};Ge=new WeakMap,Te=new WeakMap,Be=new WeakMap,Ie=new WeakMap,He=new WeakMap,mt=new WeakMap,qe=new WeakMap,Yt=new WeakMap,$e=new WeakMap,yt=new WeakMap,gt=new WeakMap,wt=new WeakMap,Pe=new WeakMap,j=new WeakMap,G=new WeakMap,Ae=new WeakMap,g=new WeakSet,Bi=async function(e){if(e.fs)this.fs=e.fs;else{let{dataDir:a,fsType:u}=vn(e.dataDir);this.fs=await Ln(a,u)}let t={},n=[],i=[`PGDATA=${R}`,`PREFIX=${Nt}`,`PGUSER=${e.username??"postgres"}`,`PGDATABASE=${e.database??"template1"}`,"MODE=REACT","REPL=N",...this.debug?["-d",this.debug.toString()]:[]],s={WASM_PREFIX:Nt,arguments:i,INITIAL_MEMORY:e.initialMemory,noExitRuntime:!0,...this.debug>0?{print:console.info,printErr:console.error}:{print:()=>{},printErr:()=>{}},locateFile:await zn(),preRun:[a=>{let u=a.FS.makedev(64,0),c={open:f=>{},close:f=>{},read:(f,h,T,B,U)=>{let bt=p(this,Pe);if(!bt)throw new Error("No /dev/blob File or Blob provided to read from");let Kt=new Uint8Array(bt);if(U>=Kt.length)return 0;let sn=Math.min(Kt.length-U,B);for(let xt=0;xt<sn;xt++)h[T+xt]=Kt[U+xt];return sn},write:(f,h,T,B,U)=>(p(this,j)??x(this,j,[]),p(this,j).push(h.slice(T,T+B)),B),llseek:(f,h,T)=>{let B=p(this,Pe);if(!B)throw new Error("No /dev/blob File or Blob provided to llseek");let U=h;if(T===1?U+=f.position:T===2&&(U=new Uint8Array(B).length),U<0)throw new a.FS.ErrnoError(28);return U}};a.FS.registerDevice(u,c),a.FS.mkdev("/dev/blob",u)}]};s=await this.fs.emscriptenOpts(s);for(let[a,u]of Object.entries(p(this,yt)))if(u instanceof URL)t[a]=Yr(u);else{let c=await u.setup(this,s);if(c.emscriptenOpts&&(s=c.emscriptenOpts),c.namespaceObj){let f=this;f[a]=c.namespaceObj}c.bundlePath&&(t[a]=Yr(c.bundlePath)),c.init&&n.push(c.init),c.close&&p(this,gt).push(c.close)}if(s.pg_extensions=t,this.mod=await cn(s),await this.fs.initialSyncFs(this.mod.FS),e.loadDataDir){if(this.mod.FS.analyzePath(R+"/PG_VERSION").exists)throw new Error("Database already exists, cannot load from tarball");d(this,g,Fe).call(this,"pglite: loading data from tarball"),await An(this.mod.FS,e.loadDataDir)}this.mod.FS.analyzePath(R+"/PG_VERSION").exists?d(this,g,Fe).call(this,"pglite: found DB, resuming"):d(this,g,Fe).call(this,"pglite: no db"),await xi(this.mod,(...a)=>d(this,g,Fe).call(this,...a));let o=this.mod._pg_initdb();if(!o)throw new Error("INITDB failed to return value");if(o&1)throw new Error("INITDB failed");if(o&2){let a=e.username??"postgres",u=e.database??"template1";if(o&4){if(!(o&12))throw new Error("Invalid db/user combination")}else if(u!=="template1"&&a!=="postgres")throw new Error("INITDB created a new datadir, but an alternative db/user was requested")}await d(this,g,ht).call(this),await d(this,g,pe).call(this,"SET search_path TO public;"),x(this,Ge,!0);for(let a of n)await a()},Vt=async function(e,t,n){return await p(this,mt).runExclusive(async()=>{d(this,g,Fe).call(this,"runQuery",e,t,n),await d(this,g,tn).call(this,n?.blob);let i=t?.map(a=>Ht(a,n?.setAllTypes))||[],s;try{s=[...await d(this,g,fe).call(this,z.parse({text:e,types:i.map(([,a])=>a)}),n),...await d(this,g,fe).call(this,z.bind({values:i.map(([a])=>a)}),n),...await d(this,g,fe).call(this,z.describe({type:"P"}),n),...await d(this,g,fe).call(this,z.execute({}),n)]}finally{await d(this,g,fe).call(this,z.sync(),n)}d(this,g,rn).call(this),p(this,Ie)||await d(this,g,ht).call(this);let o;return p(this,j)&&(o=new Blob(p(this,j)),x(this,j,void 0)),$t(s.map(([a])=>a),n,o)[0]})},pe=async function(e,t){return await p(this,mt).runExclusive(async()=>{d(this,g,Fe).call(this,"runExec",e,t),await d(this,g,tn).call(this,t?.blob);let n;try{n=await d(this,g,fe).call(this,z.query(e),t)}finally{await d(this,g,fe).call(this,z.sync(),t)}d(this,g,rn).call(this),p(this,Ie)||await d(this,g,ht).call(this);let i;return p(this,j)&&(i=new Blob(p(this,j)),x(this,j,void 0)),$t(n.map(([s])=>s),t,i)})},tn=async function(e){x(this,Pe,e?await e.arrayBuffer():void 0)},rn=function(){x(this,Pe,void 0)},dt=async function(){if(p(this,Te))throw new Error("PGlite is closing");if(p(this,Be))throw new Error("PGlite is closed");p(this,Ge)||await this.waitReady},fe=async function(e,t={}){return await this.execProtocol(e,{...t,syncToFs:!1})},ht=async function(){if(p(this,$e))return;x(this,$e,!0);let e=async()=>{await p(this,Yt).runExclusive(async()=>{x(this,$e,!1),await this.fs.syncToFs(this.mod.FS,p(this,He))})};p(this,He)?e():await e()},Fe=function(...e){this.debug>0&&console.log(...e)};var en=nn;m();cr();ur();0&&(module.exports={IdbFs,MemoryFS,Mutex,PGlite,formatQuery,messages,parse,protocol,types,uuid});
/*! Bundled license information:

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

buffer/index.js:
  (*!
   * The buffer module from node.js, for the browser.
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   *)
*/
//# sourceMappingURL=index.cjs.map