import{b as Ht,d as Pt,e as Ie,f as fe,g as Tt,h as Rt}from"./chunk-HQE2QCTQ.js";import{a as Q,b as xt,c as B,d as f,e as g,f as E,g as p,h as y,i as d,j as m}from"./chunk-RZJOGGMK.js";var q=Q(l=>{"use strict";m();y();Object.defineProperty(l,"__esModule",{value:!0});l.NoticeMessage=l.DataRowMessage=l.CommandCompleteMessage=l.ReadyForQueryMessage=l.NotificationResponseMessage=l.BackendKeyDataMessage=l.AuthenticationMD5Password=l.ParameterStatusMessage=l.ParameterDescriptionMessage=l.RowDescriptionMessage=l.Field=l.CopyResponse=l.CopyDataMessage=l.DatabaseError=l.copyDone=l.emptyQuery=l.replicationStart=l.portalSuspended=l.noData=l.closeComplete=l.bindComplete=l.parseComplete=void 0;l.parseComplete={name:"parseComplete",length:5};l.bindComplete={name:"bindComplete",length:5};l.closeComplete={name:"closeComplete",length:5};l.noData={name:"noData",length:5};l.portalSuspended={name:"portalSuspended",length:5};l.replicationStart={name:"replicationStart",length:4};l.emptyQuery={name:"emptyQuery",length:4};l.copyDone={name:"copyDone",length:4};var Ce=class extends Error{constructor(e,t,s){super(e),this.length=t,this.name=s}};l.DatabaseError=Ce;var Le=class{constructor(e,t){this.length=e,this.chunk=t,this.name="copyData"}};l.CopyDataMessage=Le;var Be=class{constructor(e,t,s,i){this.length=e,this.name=t,this.binary=s,this.columnTypes=new Array(i)}};l.CopyResponse=Be;var Fe=class{constructor(e,t,s,i,n,a,o){this.name=e,this.tableID=t,this.columnID=s,this.dataTypeID=i,this.dataTypeSize=n,this.dataTypeModifier=a,this.format=o}};l.Field=Fe;var ke=class{constructor(e,t){this.length=e,this.fieldCount=t,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};l.RowDescriptionMessage=ke;var Ne=class{constructor(e,t){this.length=e,this.parameterCount=t,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};l.ParameterDescriptionMessage=Ne;var Ue=class{constructor(e,t,s){this.length=e,this.parameterName=t,this.parameterValue=s,this.name="parameterStatus"}};l.ParameterStatusMessage=Ue;var Ge=class{constructor(e,t){this.length=e,this.salt=t,this.name="authenticationMD5Password"}};l.AuthenticationMD5Password=Ge;var ze=class{constructor(e,t,s){this.length=e,this.processID=t,this.secretKey=s,this.name="backendKeyData"}};l.BackendKeyDataMessage=ze;var je=class{constructor(e,t,s,i){this.length=e,this.processId=t,this.channel=s,this.payload=i,this.name="notification"}};l.NotificationResponseMessage=je;var Qe=class{constructor(e,t){this.length=e,this.status=t,this.name="readyForQuery"}};l.ReadyForQueryMessage=Qe;var qe=class{constructor(e,t){this.length=e,this.text=t,this.name="commandComplete"}};l.CommandCompleteMessage=qe;var We=class{constructor(e,t){this.length=e,this.fields=t,this.name="dataRow",this.fieldCount=t.length}};l.DataRowMessage=We;var He=class{constructor(e,t){this.length=e,this.message=t,this.name="notice"}};l.NoticeMessage=He});var Nt=Q(xe=>{"use strict";m();y();Object.defineProperty(xe,"__esModule",{value:!0});xe.Writer=void 0;var at=class{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=d.allocUnsafe(e)}ensure(e){var t=this.buffer.length-this.offset;if(t<e){var s=this.buffer,i=s.length+(s.length>>1)+e;this.buffer=d.allocUnsafe(i),s.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{var t=d.byteLength(e);this.ensure(t+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=t}return this.buffer[this.offset++]=0,this}addString(e=""){var t=d.byteLength(e);return this.ensure(t),this.buffer.write(e,this.offset),this.offset+=t,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let t=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(t,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){var t=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=d.allocUnsafe(this.size),t}};xe.Writer=at});var Gt=Q(Te=>{"use strict";m();y();Object.defineProperty(Te,"__esModule",{value:!0});Te.serialize=void 0;var ot=Nt(),b=new ot.Writer,$s=r=>{b.addInt16(3).addInt16(0);for(let s of Object.keys(r))b.addCString(s).addCString(r[s]);b.addCString("client_encoding").addCString("UTF8");var e=b.addCString("").flush(),t=e.length+4;return new ot.Writer().addInt32(t).add(e).flush()},Ks=()=>{let r=d.allocUnsafe(8);return r.writeInt32BE(8,0),r.writeInt32BE(80877103,4),r},Xs=r=>b.addCString(r).flush(112),Ys=function(r,e){return b.addCString(r).addInt32(d.byteLength(e)).addString(e),b.flush(112)},Js=function(r){return b.addString(r).flush(112)},Zs=r=>b.addCString(r).flush(81),Ut=[],er=r=>{let e=r.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let t=r.types||Ut;for(var s=t.length,i=b.addCString(e).addCString(r.text).addInt16(s),n=0;n<s;n++)i.addInt32(t[n]);return b.flush(80)},W=new ot.Writer,tr=function(r,e){for(let t=0;t<r.length;t++){let s=e?e(r[t],t):r[t];s==null?(b.addInt16(0),W.addInt32(-1)):s instanceof d?(b.addInt16(1),W.addInt32(s.length),W.add(s)):(b.addInt16(0),W.addInt32(d.byteLength(s)),W.addString(s))}},sr=(r={})=>{let e=r.portal||"",t=r.statement||"",s=r.binary||!1,i=r.values||Ut,n=i.length;return b.addCString(e).addCString(t),b.addInt16(n),tr(i,r.valueMapper),b.addInt16(n),b.add(W.flush()),b.addInt16(s?1:0),b.flush(66)},rr=d.from([69,0,0,0,9,0,0,0,0,0]),ir=r=>{if(!r||!r.portal&&!r.rows)return rr;let e=r.portal||"",t=r.rows||0,s=d.byteLength(e),i=4+s+1+4,n=d.allocUnsafe(1+i);return n[0]=69,n.writeInt32BE(i,1),n.write(e,5,"utf-8"),n[s+5]=0,n.writeUInt32BE(t,n.length-4),n},nr=(r,e)=>{let t=d.allocUnsafe(16);return t.writeInt32BE(16,0),t.writeInt16BE(1234,4),t.writeInt16BE(5678,6),t.writeInt32BE(r,8),t.writeInt32BE(e,12),t},ct=(r,e)=>{let s=4+d.byteLength(e)+1,i=d.allocUnsafe(1+s);return i[0]=r,i.writeInt32BE(s,1),i.write(e,5,"utf-8"),i[s]=0,i},ar=b.addCString("P").flush(68),or=b.addCString("S").flush(68),cr=r=>r.name?ct(68,`${r.type}${r.name||""}`):r.type==="P"?ar:or,ur=r=>{let e=`${r.type}${r.name||""}`;return ct(67,e)},lr=r=>b.add(r).flush(100),fr=r=>ct(102,r),Pe=r=>d.from([r,0,0,0,4]),dr=Pe(72),hr=Pe(83),pr=Pe(88),yr=Pe(99),mr={startup:$s,password:Xs,requestSsl:Ks,sendSASLInitialResponseMessage:Ys,sendSCRAMClientFinalMessage:Js,query:Zs,parse:er,bind:sr,execute:ir,describe:cr,close:ur,flush:()=>dr,sync:()=>hr,end:()=>pr,copyData:lr,copyDone:()=>yr,copyFail:fr,cancel:nr};Te.serialize=mr});var zt=Q(Re=>{"use strict";m();y();Object.defineProperty(Re,"__esModule",{value:!0});Re.BufferReader=void 0;var gr=d.allocUnsafe(0),ut=class{constructor(e=0){this.offset=e,this.buffer=gr,this.encoding="utf-8"}setBuffer(e,t){this.offset=e,this.buffer=t}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}string(e){let t=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,t}cstring(){let e=this.offset,t=e;for(;this.buffer[t++]!==0;);return this.offset=t,this.buffer.toString(this.encoding,e,t-1)}bytes(e){let t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}};Re.BufferReader=ut});var dt=Q(Se=>{"use strict";m();y();Object.defineProperty(Se,"__esModule",{value:!0});Se.Parser=void 0;var w=q(),br=zt(),lt=1,wr=4,jt=lt+wr,Qt=d.allocUnsafe(0),ft=class{constructor(e){if(this.buffer=Qt,this.bufferLength=0,this.bufferOffset=0,this.reader=new br.BufferReader,e?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=e?.mode||"text"}parse(e,t){this.mergeBuffer(e);let s=this.bufferOffset+this.bufferLength,i=this.bufferOffset;for(;i+jt<=s;){let n=this.buffer[i],a=this.buffer.readUInt32BE(i+lt),o=lt+a;if(o+i<=s){let u=this.handlePacket(i+jt,n,a,this.buffer);t(u),i+=o}else break}i===s?(this.buffer=Qt,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=s-i,this.bufferOffset=i)}mergeBuffer(e){if(this.bufferLength>0){let t=this.bufferLength+e.byteLength;if(t+this.bufferOffset>this.buffer.byteLength){let i;if(t<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)i=this.buffer;else{let n=this.buffer.byteLength*2;for(;t>=n;)n*=2;i=d.allocUnsafe(n)}this.buffer.copy(i,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=i,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=t}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,t,s,i){switch(t){case 50:return w.bindComplete;case 49:return w.parseComplete;case 51:return w.closeComplete;case 110:return w.noData;case 115:return w.portalSuspended;case 99:return w.copyDone;case 87:return w.replicationStart;case 73:return w.emptyQuery;case 68:return this.parseDataRowMessage(e,s,i);case 67:return this.parseCommandCompleteMessage(e,s,i);case 90:return this.parseReadyForQueryMessage(e,s,i);case 65:return this.parseNotificationMessage(e,s,i);case 82:return this.parseAuthenticationResponse(e,s,i);case 83:return this.parseParameterStatusMessage(e,s,i);case 75:return this.parseBackendKeyData(e,s,i);case 69:return this.parseErrorMessage(e,s,i,"error");case 78:return this.parseErrorMessage(e,s,i,"notice");case 84:return this.parseRowDescriptionMessage(e,s,i);case 116:return this.parseParameterDescriptionMessage(e,s,i);case 71:return this.parseCopyInMessage(e,s,i);case 72:return this.parseCopyOutMessage(e,s,i);case 100:return this.parseCopyData(e,s,i);default:return new w.DatabaseError("received invalid response: "+t.toString(16),s,"error")}}parseReadyForQueryMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.string(1);return new w.ReadyForQueryMessage(t,i)}parseCommandCompleteMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.cstring();return new w.CommandCompleteMessage(t,i)}parseCopyData(e,t,s){let i=s.slice(e,e+(t-4));return new w.CopyDataMessage(t,i)}parseCopyInMessage(e,t,s){return this.parseCopyMessage(e,t,s,"copyInResponse")}parseCopyOutMessage(e,t,s){return this.parseCopyMessage(e,t,s,"copyOutResponse")}parseCopyMessage(e,t,s,i){this.reader.setBuffer(e,s);let n=this.reader.byte()!==0,a=this.reader.int16(),o=new w.CopyResponse(t,i,n,a);for(let u=0;u<a;u++)o.columnTypes[u]=this.reader.int16();return o}parseNotificationMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.int32(),n=this.reader.cstring(),a=this.reader.cstring();return new w.NotificationResponseMessage(t,i,n,a)}parseRowDescriptionMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.int16(),n=new w.RowDescriptionMessage(t,i);for(let a=0;a<i;a++)n.fields[a]=this.parseField();return n}parseField(){let e=this.reader.cstring(),t=this.reader.int32(),s=this.reader.int16(),i=this.reader.int32(),n=this.reader.int16(),a=this.reader.int32(),o=this.reader.int16()===0?"text":"binary";return new w.Field(e,t,s,i,n,a,o)}parseParameterDescriptionMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.int16(),n=new w.ParameterDescriptionMessage(t,i);for(let a=0;a<i;a++)n.dataTypeIDs[a]=this.reader.int32();return n}parseDataRowMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.int16(),n=new Array(i);for(let a=0;a<i;a++){let o=this.reader.int32();n[a]=o===-1?null:this.reader.string(o)}return new w.DataRowMessage(t,n)}parseParameterStatusMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.cstring(),n=this.reader.cstring();return new w.ParameterStatusMessage(t,i,n)}parseBackendKeyData(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.int32(),n=this.reader.int32();return new w.BackendKeyDataMessage(t,i,n)}parseAuthenticationResponse(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.int32(),n={name:"authenticationOk",length:t};switch(i){case 0:break;case 3:n.length===8&&(n.name="authenticationCleartextPassword");break;case 5:if(n.length===12){n.name="authenticationMD5Password";let o=this.reader.bytes(4);return new w.AuthenticationMD5Password(t,o)}break;case 10:n.name="authenticationSASL",n.mechanisms=[];let a;do a=this.reader.cstring(),a&&n.mechanisms.push(a);while(a);break;case 11:n.name="authenticationSASLContinue",n.data=this.reader.string(t-8);break;case 12:n.name="authenticationSASLFinal",n.data=this.reader.string(t-8);break;default:throw new Error("Unknown authenticationOk message type "+i)}return n}parseErrorMessage(e,t,s,i){this.reader.setBuffer(e,s);let n={},a=this.reader.string(1);for(;a!=="\0";)n[a]=this.reader.cstring(),a=this.reader.string(1);let o=n.M,u=i==="notice"?new w.NoticeMessage(t,o):new w.DatabaseError(o,t,i);return u.severity=n.S,u.code=n.C,u.detail=n.D,u.hint=n.H,u.position=n.P,u.internalPosition=n.p,u.internalQuery=n.q,u.where=n.W,u.schema=n.s,u.table=n.t,u.column=n.c,u.dataType=n.d,u.constraint=n.n,u.file=n.F,u.line=n.L,u.routine=n.R,u}};Se.Parser=ft});var ht=Q(O=>{"use strict";m();y();Object.defineProperty(O,"__esModule",{value:!0});O.DatabaseError=O.serialize=O.parse=void 0;var Er=q();Object.defineProperty(O,"DatabaseError",{enumerable:!0,get:function(){return Er.DatabaseError}});var xr=Gt();Object.defineProperty(O,"serialize",{enumerable:!0,get:function(){return xr.serialize}});var Pr=dt();function Tr(r,e){let t=new Pr.Parser;return r.on("data",s=>t.parse(s,e)),new Promise(s=>r.on("end",()=>s()))}O.parse=Tr});m();y();m();y();m();y();var Rr=new Error("timeout while waiting for mutex to become available"),Sr=new Error("mutex already locked"),Vt=new Error("request for lock canceled"),$t=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(h){try{c(s.next(h))}catch(x){a(x)}}function u(h){try{c(s.throw(h))}catch(x){a(x)}}function c(h){h.done?n(h.value):i(h.value).then(o,u)}c((s=s.apply(r,e||[])).next())})},Oe=class{constructor(e,t=Vt){this._value=e,this._cancelError=t,this._weightedQueues=[],this._weightedWaiters=[]}acquire(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((t,s)=>{this._weightedQueues[e-1]||(this._weightedQueues[e-1]=[]),this._weightedQueues[e-1].push({resolve:t,reject:s}),this._dispatch()})}runExclusive(e,t=1){return $t(this,void 0,void 0,function*(){let[s,i]=yield this.acquire(t);try{return yield e(s)}finally{i()}})}waitForUnlock(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise(t=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),this._weightedWaiters[e-1].push(t),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatch()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatch()}cancel(){this._weightedQueues.forEach(e=>e.forEach(t=>t.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var e;for(let t=this._value;t>0;t--){let s=(e=this._weightedQueues[t-1])===null||e===void 0?void 0:e.shift();if(!s)continue;let i=this._value,n=t;this._value-=t,t=this._value+1,s.resolve([i,this._newReleaser(n)])}this._drainUnlockWaiters()}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){for(let e=this._value;e>0;e--)this._weightedWaiters[e-1]&&(this._weightedWaiters[e-1].forEach(t=>t()),this._weightedWaiters[e-1]=[])}},Kt=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(h){try{c(s.next(h))}catch(x){a(x)}}function u(h){try{c(s.throw(h))}catch(x){a(x)}}function c(h){h.done?n(h.value):i(h.value).then(o,u)}c((s=s.apply(r,e||[])).next())})},I=class{constructor(e){this._semaphore=new Oe(1,e)}acquire(){return Kt(this,void 0,void 0,function*(){let[,e]=yield this._semaphore.acquire();return e})}runExclusive(e){return this._semaphore.runExclusive(()=>e())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};m();y();import Xt from"./postgres.js";var St=Xt;m();y();var Ae=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string";async function vt(){let r=new URL("./postgres.wasm",import.meta.url),e=new URL("./postgres.data",import.meta.url),t=s=>s.pathname;return Ae&&(t=(await import("url")).fileURLToPath),s=>{let i=null;switch(s){case"postgres.data":i=e;break;case"postgres.wasm":i=r;break;default:console.error("makeLocateFile",s)}return i?.protocol==="file:"?t(i):i?.toString()??""}}var Bt={};xt(Bt,{parseResults:()=>Ee});m();y();var D=B(q(),1);var Lt={};xt(Lt,{ABSTIME:()=>us,ACLITEM:()=>gs,BIT:()=>Ps,BOOL:()=>Ve,BPCHAR:()=>bs,BYTEA:()=>pe,CHAR:()=>Dt,CID:()=>ss,CIDR:()=>cs,CIRCLE:()=>ds,DATE:()=>tt,FLOAT4:()=>Je,FLOAT8:()=>Ze,GTSVECTOR:()=>Ns,INET:()=>ms,INT2:()=>$e,INT4:()=>Ke,INT8:()=>ye,INTERVAL:()=>Es,JSON:()=>me,JSONB:()=>it,MACADDR:()=>ys,MACADDR8:()=>hs,MONEY:()=>ps,NUMERIC:()=>Rs,OID:()=>Ye,PATH:()=>as,PG_DEPENDENCIES:()=>Bs,PG_LSN:()=>Cs,PG_NDISTINCT:()=>Ls,PG_NODE_TREE:()=>is,POLYGON:()=>os,REFCURSOR:()=>Ss,REGCLASS:()=>_s,REGCONFIG:()=>Us,REGDICTIONARY:()=>Gs,REGNAMESPACE:()=>zs,REGOPER:()=>Ds,REGOPERATOR:()=>Ms,REGPROC:()=>Zt,REGPROCEDURE:()=>vs,REGROLE:()=>js,REGTYPE:()=>Is,RELTIME:()=>ls,SMGR:()=>ns,TEXT:()=>Xe,TID:()=>es,TIME:()=>ws,TIMESTAMP:()=>st,TIMESTAMPTZ:()=>rt,TIMETZ:()=>xs,TINTERVAL:()=>fs,TSQUERY:()=>ks,TSVECTOR:()=>Fs,TXID_SNAPSHOT:()=>As,UUID:()=>Os,VARBIT:()=>Ts,VARCHAR:()=>et,XID:()=>ts,XML:()=>rs,arrayTypes:()=>de,parseArray:()=>Ct,parseType:()=>we,parsers:()=>_t,serializeType:()=>be,serializerFor:()=>Ot,serializerInstanceof:()=>It,serializers:()=>he,types:()=>Mt});m();y();var Yt=globalThis.JSON.parse,Jt=globalThis.JSON.stringify,Ve=16,pe=17,Dt=18,ye=20,$e=21,Ke=23,Zt=24,Xe=25,Ye=26,es=27,ts=28,ss=29,me=114,rs=142,is=194,ns=210,as=602,os=604,cs=650,Je=700,Ze=701,us=702,ls=703,fs=704,ds=718,hs=774,ps=790,ys=829,ms=869,gs=1033,bs=1042,et=1043,tt=1082,ws=1083,st=1114,rt=1184,Es=1186,xs=1266,Ps=1560,Ts=1562,Rs=1700,Ss=1790,vs=2202,Ds=2203,Ms=2204,_s=2205,Is=2206,Os=2950,As=2970,Cs=3220,Ls=3361,Bs=3402,Fs=3614,ks=3615,Ns=3642,Us=3734,Gs=3769,it=3802,zs=4089,js=4096,de={1001:pe,1002:Dt,1016:ye,1005:$e,1007:Ke,1009:Xe,1028:Ye,199:me,1021:Je,1022:Ze,1015:et,3807:it,1182:tt,1115:st,1116:rt},Mt={string:{to:0,from:[Xe,et],serialize:r=>r,parse:r=>r},number:{to:0,from:[$e,Ke,Ye,Je,Ze],serialize:r=>r.toString(),parse:r=>+r},bigint:{to:ye,from:[ye],js:[BigInt],serialize:r=>r.toString(),parse:r=>{let e=BigInt(r);return e<Number.MIN_SAFE_INTEGER||e>Number.MAX_SAFE_INTEGER?e:Number(e)}},json:{to:me,from:[me,it],serialize:r=>Jt(r),parse:r=>Yt(r)},boolean:{to:Ve,from:[Ve],serialize:r=>r===!0?"t":"f",parse:r=>r==="t"},date:{to:1184,from:[tt,st,rt],js:[Date],serialize:r=>(r instanceof Date?r:new Date(r)).toISOString(),parse:r=>new Date(r)},bytea:{to:pe,from:[pe],js:[Uint8Array,d],serialize:r=>"\\x"+d.from(r).toString("hex"),parse:r=>new Uint8Array(d.from(r.slice(2),"hex"))},array:{to:0,from:Object.keys(de).map(r=>+r),serialize:r=>At(r),parse:(r,e)=>{let t;return e&&e in de&&(t=_t[de[e]]),Ct(r,t)}}},ge=qs(Mt),_t=ge.parsers,he=ge.serializers,It=ge.serializerInstanceof;function Ot(r){if(Array.isArray(r))return he.array;let e=he[typeof r];if(e)return e;for(let[t,s]of It)if(r instanceof t)return s;return he.json}function be(r){return r==null?[null,0]:Ot(r)(r)}function Qs(r){return'"'+r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function At(r){let e="{";for(let t=0;t<r.length;t++)if(t>0&&(e=e+","),r[t]===null||typeof r[t]>"u")e=e+"NULL";else if(Array.isArray(r[t]))e=e+At(r[t]);else if(ArrayBuffer.isView(r[t])){let s=r[t];if(!(s instanceof d)){let i=d.from(s.buffer,s.byteOffset,s.byteLength);i.length===s.byteLength?s=i:s=i.slice(s.byteOffset,s.byteOffset+s.byteLength)}e+="\\\\x"+s.toString("hex")}else e+=Qs(be(r[t])[0]);return e=e+"}",e}function Ct(r,e){let t=0,s=null,i="",n=!1,a=0,o;function u(c){let h=[];for(;t<c.length;t++){if(s=c[t],n)s==="\\"?i+=c[++t]:s==='"'?(h.push(e?e(i):i),i="",n=c[t+1]==='"',a=t+2):i+=s;else if(s==='"')n=!0;else if(s==="{")a=++t,h.push(u(c));else if(s==="}"){n=!1,a<t&&h.push(e?e(c.slice(a,t)):c.slice(a,t)),a=t+1;break}else s===","&&o!=="}"&&o!=='"'&&(h.push(e?e(c.slice(a,t)):c.slice(a,t)),a=t+1);o=s}return a<t&&h.push(e?e(c.slice(a,t+1)):c.slice(a,t+1)),h}return u(r)[0]}function we(r,e,t){if(r===null)return null;let s=t?.[e]??ge.parsers[e];return s?s(r,e):r}function qs(r){return Object.keys(r).reduce(({parsers:e,serializers:t,serializerInstanceof:s},i)=>{let{to:n,from:a,serialize:o,parse:u=null}=r[i],c=h=>[o(h),n];return t[n]=c,t[i]=c,r[i].js&&r[i].js.forEach(h=>s.push([h,c])),u&&(Array.isArray(a)?a.forEach(h=>e[h]=u):e[a]=u,e[i]=u),{parsers:e,serializers:t,serializerInstanceof:s}},{parsers:{},serializers:{},serializerInstanceof:[]})}function Ee(r,e,t){let s=[],i={rows:[],fields:[]},n=0,a=r.filter(o=>o instanceof D.RowDescriptionMessage||o instanceof D.DataRowMessage||o instanceof D.CommandCompleteMessage);return a.forEach((o,u)=>{o instanceof D.RowDescriptionMessage?i.fields=o.fields.map(c=>({name:c.name,dataTypeID:c.dataTypeID})):o instanceof D.DataRowMessage&&i?e?.rowMode==="array"?i.rows.push(o.fields.map((c,h)=>we(c,i.fields[h].dataTypeID,e?.parsers))):i.rows.push(Object.fromEntries(o.fields.map((c,h)=>[i.fields[h].name,we(c,i.fields[h].dataTypeID,e?.parsers)]))):o instanceof D.CommandCompleteMessage&&(n+=Ws(o),u===a.length-1?s.push({...i,affectedRows:n,...t?{blob:t}:{}}):s.push(i),i={rows:[],fields:[]})}),s.length===0&&s.push({rows:[],fields:[]}),s}function Ws(r){let e=r.text.split(" ");switch(e[0]){case"INSERT":return parseInt(e[2],10);case"UPDATE":case"DELETE":return parseInt(e[1],10);default:return 0}}m();y();var Ft=B(Ht(),1);async function nt(r){if(Ae){let e=await import("fs"),t=await import("zlib"),{Writable:s}=await import("stream"),{pipeline:i}=await import("stream/promises");if(!e.existsSync(r))throw new Error(`Extension bundle not found: ${r}`);let n=t.createGunzip(),a=[];return await i(e.createReadStream(r),n,new s({write(o,u,c){a.push(o),c()}})),new Blob(a)}else{let e=await fetch(r.toString());if(!e.ok||!e.body)return null;if(e.headers.get("Content-Encoding")==="gzip")return e.blob();{let t=new DecompressionStream("gzip");return new Response(e.body.pipeThrough(t)).blob()}}}async function kt(r,e){for(let t in r.pg_extensions){let s;try{s=await r.pg_extensions[t]}catch(i){console.error("Failed to fetch extension:",t,i);continue}if(s){let i=new Uint8Array(await s.arrayBuffer());Hs(r,t,i,e)}else console.error("Could not get binary data for extension:",t)}}function Hs(r,e,t,s){Ft.default.untar(t).forEach(n=>{if(!n.name.startsWith(".")){let a=r.WASM_PREFIX+"/"+n.name;if(n.name.endsWith(".so")){let o=(...c)=>{s("pgfs:ext OK",a,c)},u=(...c)=>{s("pgfs:ext FAIL",a,c)};r.FS.createPreloadedFile(Vs(a),n.name.split("/").pop().slice(0,-3),n.data,!0,!0,o,u,!1)}else r.FS.writeFile(a,n.data)}})}function Vs(r){let e=r.lastIndexOf("/");return e>0?r.slice(0,e):r}var M=B(ht(),1),pt=B(dt(),1),L=B(q(),1);var H,k,N,U,ee,ve,te,V,De,$,K,se,re,X,T,R,G,Me,Wt,ie,yt,S,A,ne,mt,ae,gt,z,J,v,C,j,Z,_,F,bt=class bt{constructor(e={},t={}){g(this,Me);g(this,ie);g(this,S);g(this,ne);g(this,ae);g(this,z);g(this,v);g(this,j);g(this,_);g(this,H,!1);g(this,k,!1);g(this,N,!1);g(this,U,!1);g(this,ee,!1);g(this,ve,new I);g(this,te,new I);g(this,V,new I);g(this,De,new I);g(this,$,!1);this.debug=0;g(this,K,void 0);g(this,se,[]);g(this,re,new pt.Parser);g(this,X,void 0);g(this,T,void 0);g(this,R,new Map);g(this,G,new Set);typeof e=="string"?t={dataDir:e,...t}:t=e,this.dataDir=t.dataDir,t?.debug!==void 0&&(this.debug=t.debug),t?.relaxedDurability!==void 0&&E(this,ee,t.relaxedDurability),E(this,K,t.extensions??{}),E(this,K,t.extensions??{}),this.waitReady=p(this,Me,Wt).call(this,t??{})}get ready(){return f(this,H)&&!f(this,k)&&!f(this,N)}get closed(){return f(this,N)}async close(){await p(this,z,J).call(this),E(this,k,!0);for(let e of f(this,se))await e();await new Promise(async(e,t)=>{try{await this.execProtocol(M.serialize.end())}catch(s){let i=s;i.name==="ExitStatus"&&i.status===0?e():t(s)}}),E(this,N,!0),E(this,k,!1)}async query(e,t,s){return await p(this,z,J).call(this),await f(this,V).runExclusive(async()=>await p(this,ie,yt).call(this,e,t,s))}async exec(e,t){return await p(this,z,J).call(this),await f(this,V).runExclusive(async()=>await p(this,S,A).call(this,e,t))}async transaction(e){return await p(this,z,J).call(this),await f(this,V).runExclusive(async()=>{await p(this,S,A).call(this,"BEGIN");let t=!1,s=()=>{if(t)throw new Error("Transaction is closed")};try{let n=await e({query:async(a,o,u)=>(s(),await p(this,ie,yt).call(this,a,o,u)),exec:async(a,o)=>(s(),await p(this,S,A).call(this,a,o)),rollback:async()=>{s(),await p(this,S,A).call(this,"ROLLBACK"),t=!0},get closed(){return t}});return t||(t=!0,await p(this,S,A).call(this,"COMMIT")),n}catch(i){throw t||await p(this,S,A).call(this,"ROLLBACK"),i}})}async execProtocol(e,{syncToFs:t=!0}={}){return await f(this,ve).runExclusive(async()=>{let s=e.length,i=this.mod;i._interactive_write(s),i.HEAPU8.set(e,1),i._interactive_one(),t&&await p(this,j,Z).call(this);let n=[],a=s+2,o=a+i._interactive_read(),u=i.HEAPU8.subarray(a,o);return f(this,re).parse(d.from(u),c=>{if(c instanceof L.DatabaseError)throw E(this,re,new pt.Parser),c;if(c instanceof L.NoticeMessage&&this.debug>0)console.warn(c);else if(c instanceof L.CommandCompleteMessage)switch(c.text){case"BEGIN":E(this,U,!0);break;case"COMMIT":case"ROLLBACK":E(this,U,!1);break}else if(c instanceof L.NotificationResponseMessage){let h=f(this,R).get(c.channel);h&&h.forEach(x=>{queueMicrotask(()=>x(c.payload))}),f(this,G).forEach(x=>{queueMicrotask(()=>x(c.channel,c.payload))})}n.push([c,u])}),n})}async listen(e,t){return f(this,R).has(e)||f(this,R).set(e,new Set),f(this,R).get(e).add(t),await this.exec(`LISTEN ${e}`),async()=>{await this.unlisten(e,t)}}async unlisten(e,t){t?(f(this,R).get(e)?.delete(t),f(this,R).get(e).size===0&&(await this.exec(`UNLISTEN ${e}`),f(this,R).delete(e))):(await this.exec(`UNLISTEN ${e}`),f(this,R).delete(e))}onNotification(e){return f(this,G).add(e),()=>{f(this,G).delete(e)}}offNotification(e){f(this,G).delete(e)}static withExtensions(e){return new bt(e)}async dumpDataDir(){let e=this.dataDir?.split("/").pop()??"pgdata";return this.fs.dumpTar(this.mod.FS,e)}};H=new WeakMap,k=new WeakMap,N=new WeakMap,U=new WeakMap,ee=new WeakMap,ve=new WeakMap,te=new WeakMap,V=new WeakMap,De=new WeakMap,$=new WeakMap,K=new WeakMap,se=new WeakMap,re=new WeakMap,X=new WeakMap,T=new WeakMap,R=new WeakMap,G=new WeakMap,Me=new WeakSet,Wt=async function(e){if(e.fs)this.fs=e.fs;else{let{dataDir:o,fsType:u}=Tt(e.dataDir);this.fs=await Rt(o,u)}let t={},s=[],i=[`PGDATA=${fe}`,`PREFIX=${Ie}`,"MODE=REACT","REPL=N",...this.debug?["-d",this.debug.toString()]:[]],n={WASM_PREFIX:Ie,arguments:i,noExitRuntime:!0,...this.debug>0?{print:console.info,printErr:console.error}:{print:()=>{},printErr:()=>{}},locateFile:await vt(),preRun:[o=>{let u=o.FS.makedev(64,0),c=0,h={open:x=>{},close:x=>{},read:(x,oe,Y,ce,ue)=>{let wt=f(this,X);if(!wt)throw new Error("No File or Blob provided to read from");let _e=new Uint8Array(wt);if(ue>=_e.length)return 0;let Et=Math.min(_e.length-ue,ce);for(let le=0;le<Et;le++)oe[Y+le]=_e[ue+le];return Et},write:(x,oe,Y,ce,ue)=>(c++,f(this,T)??E(this,T,[]),f(this,T).push(oe.slice(Y,Y+ce)),ce),llseek:(x,oe,Y)=>{throw new Error("Cannot seek /dev/blob")}};o.FS.registerDevice(u,h),o.FS.mkdev("/dev/blob",u)}]};n=await this.fs.emscriptenOpts(n);for(let[o,u]of Object.entries(f(this,K)))if(u instanceof URL)t[o]=nt(u);else{let c=await u.setup(this,n);c.emscriptenOpts&&(n=c.emscriptenOpts),c.namespaceObj&&(this[o]=c.namespaceObj),c.bundlePath&&(t[o]=nt(c.bundlePath)),c.init&&s.push(c.init),c.close&&f(this,se).push(c.close)}if(n.pg_extensions=t,this.mod=await St(n),await this.fs.initialSyncFs(this.mod.FS),e.loadDataDir){if(this.mod.FS.analyzePath(fe+"/PG_VERSION").exists)throw new Error("Database already exists, cannot load from tarball");p(this,_,F).call(this,"pglite: loading data from tarball"),await Pt(this.mod.FS,e.loadDataDir)}this.mod.FS.analyzePath(fe+"/PG_VERSION").exists?p(this,_,F).call(this,"pglite: found DB, resuming"):p(this,_,F).call(this,"pglite: no db"),await kt(this.mod,(...o)=>p(this,_,F).call(this,...o));let a=this.mod._pg_initdb();a&&(a&1&&console.log(" #1"),a&2&&console.log(" #2"),a&4&&console.log(" #3")),await p(this,j,Z).call(this),await p(this,S,A).call(this,"SET search_path TO public;"),E(this,H,!0);for(let o of s)await o()},ie=new WeakSet,yt=async function(e,t,s){return await f(this,te).runExclusive(async()=>{p(this,_,F).call(this,"runQuery",e,t,s),await p(this,ne,mt).call(this,s?.blob);let i=t?.map(o=>be(o))||[],n;try{n=[...await p(this,v,C).call(this,M.serialize.parse({text:e,types:i.map(([,o])=>o)})),...await p(this,v,C).call(this,M.serialize.bind({values:i.map(([o])=>o)})),...await p(this,v,C).call(this,M.serialize.describe({type:"P"})),...await p(this,v,C).call(this,M.serialize.execute({}))]}finally{await p(this,v,C).call(this,M.serialize.sync())}p(this,ae,gt).call(this),f(this,U)||await p(this,j,Z).call(this);let a;return f(this,T)&&(a=new Blob(f(this,T)),E(this,T,void 0)),Ee(n.map(([o])=>o),s,a)[0]})},S=new WeakSet,A=async function(e,t){return await f(this,te).runExclusive(async()=>{p(this,_,F).call(this,"runExec",e,t),await p(this,ne,mt).call(this,t?.blob);let s;try{s=await p(this,v,C).call(this,M.serialize.query(e))}finally{await p(this,v,C).call(this,M.serialize.sync())}p(this,ae,gt).call(this),f(this,U)||await p(this,j,Z).call(this);let i;return f(this,T)&&(i=new Blob(f(this,T)),E(this,T,void 0)),Ee(s.map(([n])=>n),t,i)})},ne=new WeakSet,mt=async function(e){E(this,X,e?await e.arrayBuffer():void 0)},ae=new WeakSet,gt=function(){E(this,X,void 0)},z=new WeakSet,J=async function(){if(f(this,k))throw new Error("PGlite is closing");if(f(this,N))throw new Error("PGlite is closed");f(this,H)||await this.waitReady},v=new WeakSet,C=async function(e){return await this.execProtocol(e,{syncToFs:!1})},j=new WeakSet,Z=async function(){if(f(this,$))return;E(this,$,!0);let e=async()=>{await f(this,De).runExclusive(async()=>{E(this,$,!1),await this.fs.syncToFs(this.mod.FS)})};f(this,ee)?e():await e()},_=new WeakSet,F=function(...e){this.debug>0&&console.log(...e)};var qt=bt;m();y();var Oi=B(q(),1),Ai=B(ht(),1);export{I as a,Lt as b,Bt as c,qt as d,Oi as e,Ai as f};
//# sourceMappingURL=chunk-C4V6TXF5.js.map