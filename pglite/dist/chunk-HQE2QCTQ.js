import{a as P,c as fr,h as u,j as p}from"./chunk-RZJOGGMK.js";var z=P((re,d)=>{"use strict";p();u();var Y=9007199254740991,X=function(r){return r}();function mr(r){return r===X}function K(r){return typeof r=="string"||Object.prototype.toString.call(r)=="[object String]"}function dr(r){return Object.prototype.toString.call(r)=="[object Date]"}function I(r){return r!==null&&typeof r=="object"}function M(r){return typeof r=="function"}function lr(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=Y}function yr(r){return Object.prototype.toString.call(r)=="[object Array]"}function $(r){return I(r)&&!M(r)&&lr(r.length)}function G(r){return Object.prototype.toString.call(r)=="[object ArrayBuffer]"}function gr(r,e){return Array.prototype.map.call(r,e)}function Tr(r,e){var t=X;return M(e)&&Array.prototype.every.call(r,function(n,i,c){var s=e(n,i,c);return s&&(t=n),!s}),t}function xr(r){return Object.assign.apply(null,arguments)}function Z(r){var e,t,n;if(K(r)){for(t=r.length,n=new Uint8Array(t),e=0;e<t;e++)n[e]=r.charCodeAt(e)&255;return n}return G(r)?new Uint8Array(r):I(r)&&G(r.buffer)?new Uint8Array(r.buffer):$(r)?new Uint8Array(r):I(r)&&M(r.toString)?Z(r.toString()):new Uint8Array}d.exports.MAX_SAFE_INTEGER=Y;d.exports.isUndefined=mr;d.exports.isString=K;d.exports.isObject=I;d.exports.isDateTime=dr;d.exports.isFunction=M;d.exports.isArray=yr;d.exports.isArrayLike=$;d.exports.isArrayBuffer=G;d.exports.map=gr;d.exports.find=Tr;d.exports.extend=xr;d.exports.toUint8Array=Z});var b=P((ne,J)=>{"use strict";p();u();var H="\0";J.exports={NULL_CHAR:H,TMAGIC:"ustar"+H+"00",OLDGNU_MAGIC:"ustar  "+H,REGTYPE:0,LNKTYPE:1,SYMTYPE:2,CHRTYPE:3,BLKTYPE:4,DIRTYPE:5,FIFOTYPE:6,CONTTYPE:7,TSUID:parseInt("4000",8),TSGID:parseInt("2000",8),TSVTX:parseInt("1000",8),TUREAD:parseInt("0400",8),TUWRITE:parseInt("0200",8),TUEXEC:parseInt("0100",8),TGREAD:parseInt("0040",8),TGWRITE:parseInt("0020",8),TGEXEC:parseInt("0010",8),TOREAD:parseInt("0004",8),TOWRITE:parseInt("0002",8),TOEXEC:parseInt("0001",8),TPERMALL:parseInt("0777",8),TPERMMASK:parseInt("0777",8)}});var B=P((se,l)=>{"use strict";p();u();var Q=z(),f=b(),Ar=512,_=f.TPERMALL,V=0,rr=0,j=[["name",100,0,function(r,e){return v(r[e[0]],e[1])},function(r,e,t){return S(r.slice(e,e+t[1]))}],["mode",8,100,function(r,e){var t=r[e[0]]||_;return t=t&f.TPERMMASK,E(t,e[1],_)},function(r,e,t){var n=A(r.slice(e,e+t[1]));return n&=f.TPERMMASK,n}],["uid",8,108,function(r,e){return E(r[e[0]],e[1],V)},function(r,e,t){return A(r.slice(e,e+t[1]))}],["gid",8,116,function(r,e){return E(r[e[0]],e[1],rr)},function(r,e,t){return A(r.slice(e,e+t[1]))}],["size",12,124,function(r,e){return E(r.data.length,e[1])},function(r,e,t){return A(r.slice(e,e+t[1]))}],["modifyTime",12,136,function(r,e){return k(r[e[0]],e[1])},function(r,e,t){return L(r.slice(e,e+t[1]))}],["checksum",8,148,function(r,e){return"        "},function(r,e,t){return A(r.slice(e,e+t[1]))}],["type",1,156,function(r,e){return""+(parseInt(r[e[0]],10)||0)%8},function(r,e,t){return(parseInt(String.fromCharCode(r[e]),10)||0)%8}],["linkName",100,157,function(r,e){return""},function(r,e,t){return S(r.slice(e,e+t[1]))}],["ustar",8,257,function(r,e){return f.TMAGIC},function(r,e,t){return Fr(S(r.slice(e,e+t[1]),!0))},function(r,e){return r[e[0]]==f.TMAGIC||r[e[0]]==f.OLDGNU_MAGIC}],["owner",32,265,function(r,e){return v(r[e[0]],e[1])},function(r,e,t){return S(r.slice(e,e+t[1]))}],["group",32,297,function(r,e){return v(r[e[0]],e[1])},function(r,e,t){return S(r.slice(e,e+t[1]))}],["majorNumber",8,329,function(r,e){return""},function(r,e,t){return A(r.slice(e,e+t[1]))}],["minorNumber",8,337,function(r,e){return""},function(r,e,t){return A(r.slice(e,e+t[1]))}],["prefix",131,345,function(r,e){return v(r[e[0]],e[1])},function(r,e,t){return S(r.slice(e,e+t[1]))}],["accessTime",12,476,function(r,e){return k(r[e[0]],e[1])},function(r,e,t){return L(r.slice(e,e+t[1]))}],["createTime",12,488,function(r,e){return k(r[e[0]],e[1])},function(r,e,t){return L(r.slice(e,e+t[1]))}]],er=function(r){var e=r[r.length-1];return e[2]+e[1]}(j);function Fr(r){if(r.length==8){var e=r.split("");if(e[5]==f.NULL_CHAR)return(e[6]==" "||e[6]==f.NULL_CHAR)&&(e[6]="0"),(e[7]==" "||e[7]==f.NULL_CHAR)&&(e[7]="0"),e=e.join(""),e==f.TMAGIC?e:r;if(e[7]==f.NULL_CHAR)return e[5]==f.NULL_CHAR&&(e[5]=" "),e[6]==f.NULL_CHAR&&(e[6]=" "),e==f.OLDGNU_MAGIC?e:r}return r}function v(r,e){return e-=1,Q.isUndefined(r)&&(r=""),r=(""+r).substr(0,e),r+f.NULL_CHAR}function E(r,e,t){for(t=parseInt(t)||0,e-=1,r=(parseInt(r)||t).toString(8).substr(-e,e);r.length<e;)r="0"+r;return r+f.NULL_CHAR}function k(r,e){if(Q.isDateTime(r))r=Math.floor(1*r/1e3);else if(r=parseInt(r,10),isFinite(r)){if(r<=0)return""}else r=Math.floor(1*new Date/1e3);return E(r,e,0)}function S(r,e){var t=String.fromCharCode.apply(null,r);if(e)return t;var n=t.indexOf(f.NULL_CHAR);return n>=0?t.substr(0,n):t}function A(r){var e=String.fromCharCode.apply(null,r);return parseInt(e.replace(/^0+$/g,""),8)||0}function L(r){return r.length==0||r[0]==0?null:new Date(1e3*A(r))}function wr(r,e,t){var n=parseInt(e,10)||0,i=Math.min(n+er,r.length),c=0,s=0,o=0;t&&j.every(function(F){return F[0]=="checksum"?(s=n+F[2],o=s+F[1],!1):!0});for(var a=32,m=n;m<i;m++){var h=m>=s&&m<o?a:r[m];c=(c+h)%262144}return c}l.exports.recordSize=Ar;l.exports.defaultFileMode=_;l.exports.defaultUid=V;l.exports.defaultGid=rr;l.exports.posixHeader=j;l.exports.effectiveHeaderSize=er;l.exports.calculateChecksum=wr;l.exports.formatTarString=v;l.exports.formatTarNumber=E;l.exports.formatTarDateTime=k;l.exports.parseTarString=S;l.exports.parseTarNumber=A;l.exports.parseTarDateTime=L});var or=P((ue,ir)=>{"use strict";p();u();var Sr=b(),R=z(),w=B();function tr(r){return w.recordSize}function nr(r){return Math.ceil(r.data.length/w.recordSize)*w.recordSize}function hr(r){var e=0;return r.forEach(function(t){e+=tr(t)+nr(t)}),e+=w.recordSize*2,new Uint8Array(e)}function Pr(r,e,t){t=parseInt(t)||0;var n=t;w.posixHeader.forEach(function(a){for(var m=a[3](e,a),h=m.length,F=0;F<h;F+=1)r[n+F]=m.charCodeAt(F)&255;n+=a[1]});var i=R.find(w.posixHeader,function(a){return a[0]=="checksum"});if(i){var c=w.calculateChecksum(r,t,!0),s=w.formatTarNumber(c,i[1]-2)+Sr.NULL_CHAR+" ";n=t+i[2];for(var o=0;o<s.length;o+=1)r[n]=s.charCodeAt(o)&255,n++}return t+tr(e)}function Ur(r,e,t){return t=parseInt(t,10)||0,r.set(e.data,t),t+nr(e)}function Er(r){r=R.map(r,function(n){return R.extend({},n,{data:R.toUint8Array(n.data)})});var e=hr(r),t=0;return r.forEach(function(n){t=Pr(e,n,t),t=Ur(e,n,t)}),e}ir.exports.tar=Er});var ar=P((me,sr)=>{"use strict";p();u();var zr=b(),W=z(),T=B(),br={extractData:!0,checkHeader:!0,checkChecksum:!0,checkFileSize:!0},vr={size:!0,checksum:!0,ustar:!0},q={unexpectedEndOfFile:"Unexpected end of file.",fileCorrupted:"File is corrupted.",checksumCheckFailed:"Checksum check failed."};function Cr(r){return T.recordSize}function Ir(r){return Math.ceil(r/T.recordSize)*T.recordSize}function Mr(r,e){for(var t=e,n=Math.min(r.length,e+T.recordSize*2),i=t;i<n;i++)if(r[i]!=0)return!1;return!0}function kr(r,e,t){if(r.length-e<T.recordSize){if(t.checkFileSize)throw new Error(q.unexpectedEndOfFile);return null}e=parseInt(e)||0;var n={},i=e;if(T.posixHeader.forEach(function(o){n[o[0]]=o[4](r,i,o),i+=o[1]}),n.type!=0&&(n.size=0),t.checkHeader&&T.posixHeader.forEach(function(o){if(W.isFunction(o[5])&&!o[5](n,o)){var a=new Error(q.fileCorrupted);throw a.data={offset:e+o[2],field:o[0]},a}}),t.checkChecksum){var c=T.calculateChecksum(r,e,!0);if(c!=n.checksum){var s=new Error(q.checksumCheckFailed);throw s.data={offset:e,header:n,checksum:c},s}}return n}function Lr(r,e,t,n){return n.extractData?t.size<=0?new Uint8Array:r.slice(e,e+t.size):null}function Rr(r,e){var t={};return T.posixHeader.forEach(function(n){var i=n[0];vr[i]||(t[i]=r[i])}),t.isOldGNUFormat=r.ustar==zr.OLDGNU_MAGIC,e&&(t.data=e),t}function Dr(r,e){e=W.extend({},br,e);for(var t=[],n=0,i=r.length;i-n>=T.recordSize;){r=W.toUint8Array(r);var c=kr(r,n,e);if(!c)break;n+=Cr(c);var s=Lr(r,n,c,e);if(t.push(Rr(c,s)),n+=Ir(c.size),Mr(r,n))break}return t}sr.exports.untar=Dr});var ur=P((ye,cr)=>{"use strict";p();u();var Nr=z(),Or=b(),Gr=or(),Hr=ar();Nr.extend(cr.exports,Gr,Hr,Or)});p();u();var U=class{constructor(e){this.dataDir=e}async syncToFs(e){}async initialSyncFs(e){}};p();u();var x=fr(ur(),1);p();u();p();u();var D=class extends U{async emscriptenOpts(e){return{...e,preRun:[...e.preRun||[],n=>{let i=n.FS.filesystems.IDBFS;n.FS.mkdir("/pglite"),n.FS.mkdir(`/pglite/${this.dataDir}`),n.FS.mount(i,{},`/pglite/${this.dataDir}`),n.FS.symlink(`/pglite/${this.dataDir}`,C)}]}}initialSyncFs(e){return new Promise((t,n)=>{e.syncfs(!0,i=>{i?n(i):t()})})}syncToFs(e){return new Promise((t,n)=>{e.syncfs(!1,i=>{i?n(i):t()})})}async dumpTar(e,t){return N(e,t)}};p();u();var O=class extends U{async emscriptenOpts(e){return e}async dumpTar(e,t){return N(e,t)}};var _r="/tmp/pglite",C=_r+"/base";function Ie(r){let e;if(r?.startsWith("file://")){if(r=r.slice(7),!r)throw new Error("Invalid dataDir, must be a valid path");e="nodefs"}else r?.startsWith("idb://")?(r=r.slice(6),e="idbfs"):!r||r?.startsWith("memory://")?e="memoryfs":e="nodefs";return{dataDir:r,fsType:e}}async function Me(r,e){let t;if(r&&e==="nodefs"){let{NodeFS:n}=await import("./nodefs-UAUXGVJ7.js");t=new n(r)}else r&&e==="idbfs"?t=new D(r):t=new O;return t}async function N(r,e){let t=qr(r,C),[n,i]=await Wr(t),c=(e||"pgdata")+(i?".tar.gz":".tar"),s=i?"application/x-gzip":"application/x-tar";return typeof File<"u"?new File([n],c,{type:s}):new Blob([n],{type:s})}var jr=["application/x-gtar","application/x-tar+gzip","application/x-gzip","application/gzip"];async function Ne(r,e){let t=new Uint8Array(await e.arrayBuffer()),n=typeof File<"u"&&e instanceof File?e.name:void 0;(jr.includes(e.type)||n?.endsWith(".tgz")||n?.endsWith(".tar.gz"))&&(t=await Kr(t));let c=(0,x.untar)(t);for(let s of c){let o=C+s.name,a=o.split("/").slice(0,-1);for(let m=1;m<=a.length;m++){let h=a.slice(0,m).join("/");r.analyzePath(h).exists||r.mkdir(h)}s.type==x.REGTYPE?(r.writeFile(o,s.data),r.utime(o,pr(s.modifyTime),pr(s.modifyTime))):s.type==x.DIRTYPE&&r.mkdir(o)}}function Br(r,e){let t=[],n=i=>{r.readdir(i).forEach(s=>{if(s==="."||s==="..")return;let o=i+"/"+s,a=r.stat(o),m=r.isFile(a.mode)?r.readFile(o,{encoding:"binary"}):new Uint8Array(0);t.push({name:o.substring(e.length),mode:a.mode,size:a.size,type:r.isFile(a.mode)?x.REGTYPE:x.DIRTYPE,modifyTime:a.mtime,data:m}),r.isDir(a.mode)&&n(o)})};return n(e),t}function qr(r,e){let t=Br(r,e);return(0,x.tar)(t)}async function Wr(r){return typeof window<"u"&&"CompressionStream"in window?[await Yr(r),!0]:typeof process<"u"&&process.versions&&process.versions.node?[await Xr(r),!0]:[r,!1]}async function Yr(r){let e=new CompressionStream("gzip"),t=e.writable.getWriter(),n=e.readable.getReader();t.write(r),t.close();let i=[];for(;;){let{value:o,done:a}=await n.read();if(a)break;o&&i.push(o)}let c=new Uint8Array(i.reduce((o,a)=>o+a.length,0)),s=0;return i.forEach(o=>{c.set(o,s),s+=o.length}),c}async function Xr(r){let{promisify:e}=await import("util"),{gzip:t}=await import("zlib");return await e(t)(r)}async function Kr(r){if(typeof window<"u"&&"DecompressionStream"in window)return await $r(r);if(typeof process<"u"&&process.versions&&process.versions.node)return await Zr(r);throw new Error("Unsupported environment for decompression")}async function $r(r){let e=new DecompressionStream("gzip"),t=e.writable.getWriter(),n=e.readable.getReader();t.write(r),t.close();let i=[];for(;;){let{value:o,done:a}=await n.read();if(a)break;o&&i.push(o)}let c=new Uint8Array(i.reduce((o,a)=>o+a.length,0)),s=0;return i.forEach(o=>{c.set(o,s),s+=o.length}),c}async function Zr(r){let{promisify:e}=await import("util"),{gunzip:t}=await import("zlib");return await e(t)(r)}function pr(r){return r?typeof r=="number"?r:Math.floor(r.getTime()/1e3):Math.floor(Date.now()/1e3)}export{U as a,ur as b,N as c,Ne as d,_r as e,C as f,Ie as g,Me as h};
//# sourceMappingURL=chunk-HQE2QCTQ.js.map